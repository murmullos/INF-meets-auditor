<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Auditor de transcripciones</title>
</head>
<body>
  <header>
    <h1>üìù Auditor <span id="app-version" class="version-badge"></span></h1>
    <div class="right">
      <label class="btn">
        <input id="file" type="file" accept="application/json" hidden />
        Cargar Backup
      </label>

      <button id="saveBackup" class="btn">Guardar Backup</button>
      <button id="exportCsv" class="btn btn-success">Exportar Excel (CSV)</button>
      <button id="reset" class="btn btn-danger">Borrar estado</button>
    </div>
  </header>

  <!-- Tabs selector -->
  <div class="tabs">
    <button id="tabTrans" class="tab-btn" aria-selected="true">Transcripci√≥n</button>
    <button id="tabSynth" class="tab-btn" aria-selected="false">S√≠ntesis</button>
    <button id="tabHelp" class="tab-btn tab-help" aria-selected="false">üìñ Ayuda</button>
  </div>

  <!-- Sidebar leyenda de errores por tab -->
  <div id="sidebar-legend">
    <div class="legend-toggle" id="legend-toggle-btn">
      <span class="legend-chevron" id="legend-chevron">‚ñ∂</span>
      Leyenda de errores
    </div>
    <div id="sidebar-legend-content"></div>
  </div>

  <!-- ====== TAB: TRANSCRIPCI√ìN ====== -->
  <div id="tabTransWrap">
    <details class="source-toggle" id="jsonSourceSectionT">
      <summary>Cargar JSON source de transcripci√≥n</summary>
      <div class="quiet-box">
        <p class="small muted">Pega aqu√≠ el JSON source de transcripci√≥n para procesarlo:</p>
        <textarea id="jsonSourceTextT" rows="8" placeholder="Pega el JSON source aqu√≠..." style="width: 100%; font-family: monospace; font-size: 12px; margin-bottom: 8px;"></textarea>
        <div id="jsonValidationT" class="small" style="margin-bottom: 8px;"></div>
        <button id="loadJsonSourceT" class="btn" disabled>Cargar transcripci√≥n</button>
      </div>
    </details>
    <div class="container">
      <section class="panel">
        <h2>Configuraci√≥n y filtros (Transcripci√≥n)</h2>
        <div class="controls">
          <div>
            <label>Buscar (texto/hablante):</label>
            <input id="qT" type="text" placeholder="Escribe para filtrar‚Ä¶ (Enter limpia)" />
          </div>
          <details>
            <summary>Tipos de error visibles (colapsado)</summary>
            <div class="quiet-box">
              <div id="errorsTogglesT" class="error-group"></div>
              <p class="small muted">Clic en un tipo para activarlo o desactivarlo.</p>
            </div>
          </details>


          <div class="kpis">
            <div class="kpi"><h3>Bloques</h3><div id="kpiBlocksT" class="num">0</div></div>
            <div class="kpi"><h3>Bloques con error</h3><div id="kpiBlocksErrT" class="num">0</div></div>
            <div class="kpi"><h3>Errores totales</h3><div id="kpiErrT" class="num">0</div></div>
            <div class="kpi"><h3>Tipos activos</h3><div id="kpiTypesT" class="num">0</div></div>
            <div class="kpi"><h3>Palabras totales</h3><div id="kpiWordsT" class="num">0</div></div>
          </div>
        </div>
      </section>

      <section class="panel">
        <h2>Bloques de transcripci√≥n</h2>
        <div class="row small muted" style="margin-bottom:8px">
          <span>Atajos: clic en chips suma / Alt+clic resta</span>
          <span class="spacer"></span>
        </div>
        <div id="mainBlocksT" class="main-content-scroll">
          <ol id="listT" class="list"></ol>
        </div>

        <h2>Resumen</h2>
        <div id="summaryT" class="summary"></div>
      </section>
    </div>
  </div>

  <!-- ====== TAB: S√çNTESIS ====== -->
  <div id="tabSynthWrap" class="hidden">
    <!-- Secci√≥n de carga JSON source -->
    <details class="source-toggle" id="jsonSourceSectionS">
      <summary>Cargar JSON source de s√≠ntesis</summary>
      <div class="quiet-box">
        <p class="small muted">Pega aqu√≠ el JSON source de s√≠ntesis para procesarlo:</p>
        <textarea id="jsonSourceTextS" rows="8" placeholder="Pega el JSON source aqu√≠..." style="width: 100%; font-family: monospace; font-size: 12px; margin-bottom: 8px;"></textarea>
        <div id="jsonValidationS" class="small" style="margin-bottom: 8px;"></div>
        <button id="loadJsonSourceS" class="btn" disabled>Cargar s√≠ntesis</button>
      </div>
    </details>
    <div class="container">
      <section class="panel">
        <h2>Configuraci√≥n y filtros (S√≠ntesis)</h2>
        <div class="controls">
          <div>
            <label>Buscar (t√≠tulo/texto):</label>
            <input id="qS" type="text" placeholder="Escribe para filtrar‚Ä¶ (Enter limpia)" />
          </div>
          <details>
            <summary>Tipos de error visibles (colapsado)</summary>
            <div class="quiet-box">
              <div id="errorsTogglesS" class="error-group"></div>
              <p class="small muted">Clic en un tipo para activarlo o desactivarlo.</p>
            </div>
          </details>

          <div class="kpis">
            <div class="kpi"><h3>Bloques</h3><div id="kpiBlocksS" class="num">0</div></div>
            <div class="kpi"><h3>Bloques con error</h3><div id="kpiBlocksErrS" class="num">0</div></div>
            <div class="kpi"><h3>Errores totales</h3><div id="kpiErrS" class="num">0</div></div>
            <div class="kpi"><h3>Tipos activos</h3><div id="kpiTypesS" class="num">0</div></div>
            <div class="kpi"><h3>Palabras totales</h3><div id="kpiWordsS" class="num">0</div></div>
          </div>
        </div>
      </section>

      <section class="panel">
        <h2>Bloques de s√≠ntesis</h2>
        <div class="row small muted" style="margin-bottom:8px">
          <span>Atajos: clic en chips suma / Alt+clic resta</span>
          <span class="spacer"></span>
        </div>
        <div id="mainBlocksS" class="main-content-scroll">
          <ol id="listS" class="list"></ol>
        </div>
        <div style="margin: 1.5em 0 0.5em 0;">
          <label for="global-synth-textarea" style="font-weight:600;">S√≠ntesis global del auditor:</label>
          <textarea id="global-synth-textarea" rows="3" style="width:100%;margin-top:0.5em;resize:vertical;"></textarea>
        </div>
        <h2>Resumen</h2>
        <div id="summaryS" class="summary"></div>
      </section>
    </div>
  </div>

  <!-- ====== TAB: AYUDA ====== -->
  <div id="tabHelpWrap" class="hidden">
    <div class="container">
      <section class="panel">
        <h2>üìñ Ayuda y documentaci√≥n</h2>
        <div class="help-content">

          <div class="help-section">
            <h3>¬øC√≥mo exportar tu transcripci√≥n/s√≠ntesis?</h3>
            <ol>
              <li>Ve al enlace de la reuni√≥n en la app de Infinia V1 y selecciona la pesta√±a <b>Transcripci√≥n</b> o <b>S√≠ntesis</b>.</li>
              <li>Accede al <b>debugger</b> de tu navegador (<kbd>F12</kbd>).</li>
              <li>Ve a la pesta√±a <b>Network</b> o <b>Red</b>.</li>
              <li>Haz click en la llamada a la API que contiene la response.<br>
                <span class="ejemplo-url">Ejemplo: <code>https://infinia-app.private.infinia.dev.gcp.paradigmadigital.com/meetings/01K1TB0RKAFJ19M8WE7A5BXT4X</code></span>
              </li>
              <li>Haz click en la pesta√±a <b>Response</b>.</li>
              <li>Selecciona todo el texto y c√≥pialo.</li>
              <li>Pega el contenido en la secci√≥n "Cargar JSON source" del tab correspondiente.</li>
            </ol>
            <div class="info-tip">
              <b>Nota:</b> El auditor detecta autom√°ticamente si el JSON corresponde a transcripci√≥n o s√≠ntesis y valida su formato antes de cargarlo.
            </div>
          </div>

          <div class="help-section">
            <h3>üîß C√≥mo usar el Auditor</h3>
            <ol>
              <li><b>Cargar datos:</b> Usa las secciones "Cargar JSON source" en cada tab para importar transcripciones o s√≠ntesis.</li>
              <li><b>Anotar errores:</b> Haz clic en los chips de error junto a cada bloque para incrementar/decrementar contadores.</li>
              <li><b>A√±adir notas:</b> Usa el bot√≥n "A√±adir nota" para comentarios espec√≠ficos sobre cada bloque.</li>
              <li><b>Filtrar contenido:</b> Usa el campo de b√∫squeda para filtrar bloques por contenido.</li>
              <li><b>Exportar resultados:</b> Usa "Exportar Excel (CSV)" para generar un informe completo.</li>
              <li><b>Guardar progreso:</b> Usa "Guardar Backup" para exportar todo tu trabajo y "Cargar Backup" para restaurarlo.</li>
            </ol>
          </div>

          <div class="help-section">
            <h3>üìä Tipos de Errores</h3>

            <h4>Transcripci√≥n:</h4>
            <ul>
              <li><b>Err. orador:</b> Hablante asignado ‚â† real</li>
              <li><b>Err. cambio habl.:</b> Se omiti√≥ cambio de hablante</li>
              <li><b>Err. t√©rmino:</b> Palabra mal transcrita</li>
              <li><b>Err. precisi√≥n:</b> Informaci√≥n mal recogida</li>
              <li><b>Err. omisi√≥n:</b> Falta info que s√≠ se dijo</li>
              <li><b>Err. a√±adido:</b> Se a√±adi√≥ contenido no dicho</li>
              <li><b>Err. colapso:</b> Voces simult√°neas mal tratadas</li>
              <li><b>Err. ortograf√≠a:</b> Ortograf√≠a/puntuaci√≥n pobre</li>
              <li><b>Err. estilo:</b> Ruido excesivo / muletillas</li>
              <li><b>Err. fragmentaci√≥n:</b> Bloques separados de un mismo orador</li>
            </ul>

            <h4>S√≠ntesis:</h4>
            <ul>
              <li><b>Coherencia:</b> Ideas conectadas y ordenadas</li>
              <li><b>Completitud:</b> Cubre todos los puntos clave</li>
              <li><b>Relevancia:</b> Evita ruido y relleno</li>
              <li><b>Redundancia:</b> Repeticiones innecesarias</li>
              <li><b>Estructura:</b> Titulado y secciones claras</li>
              <li><b>Segmentaci√≥n:</b> Exceso de conceptos en mismo bloque</li>
            </ul>
          </div>

          <div class="help-section">
            <h3>üí° Consejos</h3>
            <ul>
              <li>Los datos se guardan autom√°ticamente en tu navegador mientras trabajas.</li>
              <li>Puedes usar <kbd>Alt + Clic</kbd> o <kbd>Cmd + Clic</kbd> en los chips de error para decrementar.</li>
              <li>El t√≠tulo de la reuni√≥n se extrae autom√°ticamente del JSON y aparece en el header.</li>
              <li>Los archivos exportados incluyen el t√≠tulo de la reuni√≥n en el nombre.</li>
              <li>Los timestamps se calculan relativamente al inicio de la reuni√≥n.</li>
            </ul>
          </div>

        </div>
      </section>
    </div>
  </div>

  <!-- Footer fijo colapsable de totales (combinado) -->
  <div id="footerTotals" class="footer-fixed">
    <div class="footer-bar">
      <button id="toggleFooter" class="btn">Totales</button>
      <div class="badge" id="badgeTotals">Errores: 0</div>
      <div class="badge" id="badgeBlocks">Bloques con error: 0</div>
      <div class="badge" id="badgeWords">Palabras totales: 0</div>
      <div class="footer-version" id="footer-version"></div>
      <div class="spacer"></div>
      <span class="small muted">Clic en "Totales" para desplegar</span>
    </div>
    <div class="footer-panel" id="footerPanel"></div>
  </div>

  <!-- Mostrar conteo de palabras -->
  <div id="word-count-info" style="margin: 1em 0; font-weight: bold; color: #2d3a4b;"></div>

</body>
</html>
