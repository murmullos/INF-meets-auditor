<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Auditor de transcripciones</title>
</head>
<body>
  <header>
    <h1>üìù Auditor <span id="app-version" class="version-badge"></span></h1>
    <div class="right">
      <label class="btn">
        <input id="file" type="file" accept="application/json" hidden />
        Cargar Backup
      </label>

      <button id="saveBackup" class="btn">Guardar Backup</button>
      <button id="exportCsv" class="btn btn-success">Exportar Excel (CSV)</button>
      <button id="reset" class="btn btn-danger">Borrar estado</button>
    </div>
  </header>

  <!-- Tabs selector -->
  <div class="tabs">
    <button id="tabTrans" class="tab-btn" aria-selected="true">Transcripci√≥n</button>
    <button id="tabSynth" class="tab-btn" aria-selected="false">S√≠ntesis</button>
    <button id="tabHelp" class="tab-btn tab-help" aria-selected="false">üìñ Ayuda</button>
  </div>

  <!-- Sidebar leyenda de errores por tab -->
  <div id="sidebar-legend">
    <div class="legend-toggle" id="legend-toggle-btn">
      <span class="legend-chevron" id="legend-chevron">‚ñ∂</span>
      Leyenda de errores
    </div>
    <div id="sidebar-legend-content"></div>
  </div>

  <!-- ====== TAB: TRANSCRIPCI√ìN ====== -->
  <div id="tabTransWrap">
    <details class="source-toggle" id="jsonSourceSectionT">
      <summary>Cargar JSON source de transcripci√≥n</summary>
      <div class="quiet-box">
        <p class="small muted">Pega aqu√≠ el JSON source de transcripci√≥n para procesarlo:</p>
        <textarea id="jsonSourceTextT" rows="8" placeholder="Pega el JSON source aqu√≠..." style="width: 100%; font-family: monospace; font-size: 12px; margin-bottom: 8px;"></textarea>
        <div id="jsonValidationT" class="small" style="margin-bottom: 8px;"></div>
        <button id="loadJsonSourceT" class="btn" disabled>Cargar transcripci√≥n</button>
      </div>
    </details>
    <div class="container">
      <section class="panel">
        <h2>Configuraci√≥n y filtros (Transcripci√≥n)</h2>
        <div class="controls">
          <div>
            <label>Buscar (texto/hablante):</label>
            <input id="qT" type="text" placeholder="Escribe para filtrar‚Ä¶ (Enter limpia)" />
          </div>
          <details>
            <summary>Tipos de error visibles (colapsado)</summary>
            <div class="quiet-box">
              <div id="errorsTogglesT" class="error-group"></div>
              <p class="small muted">Clic en un tipo para activarlo o desactivarlo.</p>
            </div>
          </details>


          <div class="kpis">
            <div class="kpi"><h3>Bloques</h3><div id="kpiBlocksT" class="num">0</div></div>
            <div class="kpi"><h3>Bloques con error</h3><div id="kpiBlocksErrT" class="num">0</div></div>
            <div class="kpi"><h3>Errores totales</h3><div id="kpiErrT" class="num">0</div></div>
            <div class="kpi"><h3>Tipos activos</h3><div id="kpiTypesT" class="num">0</div></div>
            <div class="kpi"><h3>Palabras totales</h3><div id="kpiWordsT" class="num">0</div></div>
          </div>
        </div>
      </section>

      <section class="panel">
        <h2>Bloques de transcripci√≥n</h2>
        <div class="row small muted" style="margin-bottom:8px">
          <span>Atajos: clic en chips suma / Alt+clic resta</span>
          <span class="spacer"></span>
        </div>
        <div id="mainBlocksT" class="main-content-scroll">
          <ol id="listT" class="list"></ol>
        </div>

        <h2>Resumen</h2>
        <div id="summaryT" class="summary"></div>
      </section>
    </div>
  </div>

  <!-- ====== TAB: S√çNTESIS ====== -->
  <div id="tabSynthWrap" class="hidden">
    <!-- Secci√≥n de carga JSON source -->
    <details class="source-toggle" id="jsonSourceSectionS">
      <summary>Cargar JSON source de s√≠ntesis</summary>
      <div class="quiet-box">
        <p class="small muted">Pega aqu√≠ el JSON source de s√≠ntesis para procesarlo:</p>
        <textarea id="jsonSourceTextS" rows="8" placeholder="Pega el JSON source aqu√≠..." style="width: 100%; font-family: monospace; font-size: 12px; margin-bottom: 8px;"></textarea>
        <div id="jsonValidationS" class="small" style="margin-bottom: 8px;"></div>
        <button id="loadJsonSourceS" class="btn" disabled>Cargar s√≠ntesis</button>
      </div>
    </details>
    <div class="container">
      <section class="panel">
        <h2>Configuraci√≥n y filtros (S√≠ntesis)</h2>
        <div class="controls">
          <div>
            <label>Buscar (t√≠tulo/texto):</label>
            <input id="qS" type="text" placeholder="Escribe para filtrar‚Ä¶ (Enter limpia)" />
          </div>
          <details>
            <summary>Tipos de error visibles (colapsado)</summary>
            <div class="quiet-box">
              <div id="errorsTogglesS" class="error-group"></div>
              <p class="small muted">Clic en un tipo para activarlo o desactivarlo.</p>
            </div>
          </details>

          <div class="kpis">
            <div class="kpi"><h3>Bloques</h3><div id="kpiBlocksS" class="num">0</div></div>
            <div class="kpi"><h3>Bloques con error</h3><div id="kpiBlocksErrS" class="num">0</div></div>
            <div class="kpi"><h3>Errores totales</h3><div id="kpiErrS" class="num">0</div></div>
            <div class="kpi"><h3>Tipos activos</h3><div id="kpiTypesS" class="num">0</div></div>
            <div class="kpi"><h3>Palabras totales</h3><div id="kpiWordsS" class="num">0</div></div>
          </div>
        </div>
      </section>

      <section class="panel">
        <h2>Bloques de s√≠ntesis</h2>
        <div class="row small muted" style="margin-bottom:8px">
          <span>Atajos: clic en chips suma / Alt+clic resta</span>
          <span class="spacer"></span>
        </div>
        <div id="mainBlocksS" class="main-content-scroll">
          <ol id="listS" class="list"></ol>
        </div>
        <div style="margin: 1.5em 0 0.5em 0;">
          <label for="global-synth-textarea" style="font-weight:600;">S√≠ntesis global del auditor:</label>
          <textarea id="global-synth-textarea" rows="3" style="width:100%;margin-top:0.5em;resize:vertical;"></textarea>
        </div>
        <h2>Resumen</h2>
        <div id="summaryS" class="summary"></div>
      </section>
    </div>
  </div>

  <!-- ====== TAB: AYUDA ====== -->
  <div id="tabHelpWrap" class="hidden">
    <div class="container">
      <section class="panel">
        <h2>üìñ Ayuda y documentaci√≥n</h2>
        <div class="help-content">

          <div class="help-section">
            <h3>¬øC√≥mo exportar tu transcripci√≥n/s√≠ntesis?</h3>
            <ol>
              <li>Ve al enlace de la reuni√≥n en la app de Infinia V1 y selecciona la pesta√±a <b>Transcripci√≥n</b> o <b>S√≠ntesis</b>.</li>
              <li>Accede al <b>debugger</b> de tu navegador (<kbd>F12</kbd>).</li>
              <li>Ve a la pesta√±a <b>Network</b> o <b>Red</b>.</li>
              <li>Haz click en la llamada a la API que contiene la response.<br>
                <span class="ejemplo-url">Ejemplo: <code>https://infinia-app.private.infinia.dev.gcp.paradigmadigital.com/meetings/01K1TB0RKAFJ19M8WE7A5BXT4X</code></span>
              </li>
              <li>Haz click en la pesta√±a <b>Response</b>.</li>
              <li>Selecciona todo el texto y c√≥pialo.</li>
              <li>Pega el contenido en la secci√≥n "Cargar JSON source" del tab correspondiente.</li>
            </ol>
            <div class="info-tip">
              <b>Nota:</b> El auditor detecta autom√°ticamente si el JSON corresponde a transcripci√≥n o s√≠ntesis y valida su formato antes de cargarlo.
            </div>
          </div>

          <div class="help-section">
            <h3>üîß C√≥mo usar el Auditor</h3>
            <ol>
              <li><b>Cargar datos:</b> Usa las secciones "Cargar JSON source" en cada tab para importar transcripciones o s√≠ntesis.</li>
              <li><b>Anotar errores:</b> Haz clic en los chips de error junto a cada bloque para incrementar/decrementar contadores.</li>
              <li><b>A√±adir notas:</b> Usa el bot√≥n "A√±adir nota" para comentarios espec√≠ficos sobre cada bloque.</li>
              <li><b>Filtrar contenido:</b> Usa el campo de b√∫squeda para filtrar bloques por contenido.</li>
              <li><b>Exportar resultados:</b> Usa "Exportar Excel (CSV)" para generar un informe completo.</li>
              <li><b>Guardar progreso:</b> Usa "Guardar Backup" para exportar todo tu trabajo y "Cargar Backup" para restaurarlo.</li>
            </ol>
          </div>

          <div class="help-section">
            <h3>üìä Tipos de Errores</h3>

            <h4>Transcripci√≥n:</h4>
            <ul>
              <li><b>Err. orador:</b> Hablante asignado ‚â† real</li>
              <li><b>Err. cambio habl.:</b> Se omiti√≥ cambio de hablante</li>
              <li><b>Err. t√©rmino:</b> Palabra mal transcrita</li>
              <li><b>Err. precisi√≥n:</b> Informaci√≥n mal recogida</li>
              <li><b>Err. omisi√≥n:</b> Falta info que s√≠ se dijo</li>
              <li><b>Err. a√±adido:</b> Se a√±adi√≥ contenido no dicho</li>
              <li><b>Err. colapso:</b> Voces simult√°neas mal tratadas</li>
              <li><b>Err. ortograf√≠a:</b> Ortograf√≠a/puntuaci√≥n pobre</li>
              <li><b>Err. estilo:</b> Ruido excesivo / muletillas</li>
              <li><b>Err. fragmentaci√≥n:</b> Bloques separados de un mismo orador</li>
            </ul>

            <h4>S√≠ntesis:</h4>
            <ul>
              <li><b>Coherencia:</b> Ideas conectadas y ordenadas</li>
              <li><b>Completitud:</b> Cubre todos los puntos clave</li>
              <li><b>Relevancia:</b> Evita ruido y relleno</li>
              <li><b>Redundancia:</b> Repeticiones innecesarias</li>
              <li><b>Estructura:</b> Titulado y secciones claras</li>
              <li><b>Segmentaci√≥n:</b> Exceso de conceptos en mismo bloque</li>
            </ul>
          </div>

          <div class="help-section">
            <h3>üí° Consejos</h3>
            <ul>
              <li>Los datos se guardan autom√°ticamente en tu navegador mientras trabajas.</li>
              <li>Puedes usar <kbd>Alt + Clic</kbd> o <kbd>Cmd + Clic</kbd> en los chips de error para decrementar.</li>
              <li>El t√≠tulo de la reuni√≥n se extrae autom√°ticamente del JSON y aparece en el header.</li>
              <li>Los archivos exportados incluyen el t√≠tulo de la reuni√≥n en el nombre.</li>
              <li>Los timestamps se calculan relativamente al inicio de la reuni√≥n.</li>
            </ul>
          </div>

        </div>
      </section>
    </div>
  </div>

  <!-- Footer fijo colapsable de totales (combinado) -->
  <div id="footerTotals" class="footer-fixed">
    <div class="footer-bar">
      <button id="toggleFooter" class="btn">Totales</button>
      <div class="badge" id="badgeTotals">Errores: 0</div>
      <div class="badge" id="badgeBlocks">Bloques con error: 0</div>
      <div class="badge" id="badgeWords">Palabras totales: 0</div>
      <div class="footer-version" id="footer-version"></div>
      <div class="spacer"></div>
      <span class="small muted">Clic en "Totales" para desplegar</span>
    </div>
    <div class="footer-panel" id="footerPanel"></div>
  </div>

  <!-- Mostrar conteo de palabras -->
  <div id="word-count-info" style="margin: 1em 0; font-weight: bold; color: #2d3a4b;"></div>

<script>/******/ (() => { // webpackBootstrap
/******/ 	"use strict";
/******/ 	var __webpack_modules__ = ({

/***/ 56:
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {



/* istanbul ignore next  */
function setAttributesWithoutAttributes(styleElement) {
  var nonce =  true ? __webpack_require__.nc : 0;
  if (nonce) {
    styleElement.setAttribute("nonce", nonce);
  }
}
module.exports = setAttributesWithoutAttributes;

/***/ }),

/***/ 72:
/***/ ((module) => {



var stylesInDOM = [];
function getIndexByIdentifier(identifier) {
  var result = -1;
  for (var i = 0; i < stylesInDOM.length; i++) {
    if (stylesInDOM[i].identifier === identifier) {
      result = i;
      break;
    }
  }
  return result;
}
function modulesToDom(list, options) {
  var idCountMap = {};
  var identifiers = [];
  for (var i = 0; i < list.length; i++) {
    var item = list[i];
    var id = options.base ? item[0] + options.base : item[0];
    var count = idCountMap[id] || 0;
    var identifier = "".concat(id, " ").concat(count);
    idCountMap[id] = count + 1;
    var indexByIdentifier = getIndexByIdentifier(identifier);
    var obj = {
      css: item[1],
      media: item[2],
      sourceMap: item[3],
      supports: item[4],
      layer: item[5]
    };
    if (indexByIdentifier !== -1) {
      stylesInDOM[indexByIdentifier].references++;
      stylesInDOM[indexByIdentifier].updater(obj);
    } else {
      var updater = addElementStyle(obj, options);
      options.byIndex = i;
      stylesInDOM.splice(i, 0, {
        identifier: identifier,
        updater: updater,
        references: 1
      });
    }
    identifiers.push(identifier);
  }
  return identifiers;
}
function addElementStyle(obj, options) {
  var api = options.domAPI(options);
  api.update(obj);
  var updater = function updater(newObj) {
    if (newObj) {
      if (newObj.css === obj.css && newObj.media === obj.media && newObj.sourceMap === obj.sourceMap && newObj.supports === obj.supports && newObj.layer === obj.layer) {
        return;
      }
      api.update(obj = newObj);
    } else {
      api.remove();
    }
  };
  return updater;
}
module.exports = function (list, options) {
  options = options || {};
  list = list || [];
  var lastIdentifiers = modulesToDom(list, options);
  return function update(newList) {
    newList = newList || [];
    for (var i = 0; i < lastIdentifiers.length; i++) {
      var identifier = lastIdentifiers[i];
      var index = getIndexByIdentifier(identifier);
      stylesInDOM[index].references--;
    }
    var newLastIdentifiers = modulesToDom(newList, options);
    for (var _i = 0; _i < lastIdentifiers.length; _i++) {
      var _identifier = lastIdentifiers[_i];
      var _index = getIndexByIdentifier(_identifier);
      if (stylesInDOM[_index].references === 0) {
        stylesInDOM[_index].updater();
        stylesInDOM.splice(_index, 1);
      }
    }
    lastIdentifiers = newLastIdentifiers;
  };
};

/***/ }),

/***/ 113:
/***/ ((module) => {



/* istanbul ignore next  */
function styleTagTransform(css, styleElement) {
  if (styleElement.styleSheet) {
    styleElement.styleSheet.cssText = css;
  } else {
    while (styleElement.firstChild) {
      styleElement.removeChild(styleElement.firstChild);
    }
    styleElement.appendChild(document.createTextNode(css));
  }
}
module.exports = styleTagTransform;

/***/ }),

/***/ 164:
/***/ ((module, __webpack_exports__, __webpack_require__) => {

/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   A: () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _node_modules_css_loader_dist_runtime_noSourceMaps_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(601);
/* harmony import */ var _node_modules_css_loader_dist_runtime_noSourceMaps_js__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_node_modules_css_loader_dist_runtime_noSourceMaps_js__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(314);
/* harmony import */ var _node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_1__);
// Imports


var ___CSS_LOADER_EXPORT___ = _node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_1___default()((_node_modules_css_loader_dist_runtime_noSourceMaps_js__WEBPACK_IMPORTED_MODULE_0___default()));
// Module
___CSS_LOADER_EXPORT___.push([module.id, `:root{--bg: #f7fafc;--panel: #ffffff;--muted: #64748b;--text: #24324a;--accent: #2563eb;--accent-2: #16a34a;--danger: #dc2626;--chip: #eef2ff;--chipText: #1e293b;--chipBorder: #c7d2fe;--border: #e5e7eb;--shadow: 0 1px 3px rgba(2,8,23,.06), 0 1px 2px rgba(2,8,23,.04);--shadow-lg: 0 10px 15px rgba(2,8,23,.06), 0 4px 6px rgba(2,8,23,.05);--radius: 14px}html,body{height:100%}body{margin:0;background:var(--bg);color:var(--text);font:15px/1.55 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,"Helvetica Neue",Arial,"Noto Sans","Apple Color Emoji","Segoe UI Emoji"}header{display:flex;gap:12px;align-items:center;padding:14px 16px;border-bottom:1px solid var(--border);position:sticky;top:0;background:hsla(0,0%,100%,.9);backdrop-filter:blur(6px);z-index:20}header h1{font-size:18px;margin:0;letter-spacing:.2px;display:flex;align-items:center;gap:.5rem}header h1 .version-badge{background:hsla(0,0%,100%,.2);color:hsla(0,0%,100%,.9);font-size:.75rem;font-weight:500;padding:.25rem .5rem;border-radius:12px;border:1px solid hsla(0,0%,100%,.3);font-family:"Courier New",monospace;letter-spacing:.5px}header .right{margin-left:auto;display:flex;gap:8px;align-items:center}header .right label{font-size:13px;line-height:15px}.tabs{display:flex;gap:6px;background:#fff;border-bottom:1px solid var(--border);position:sticky;top:56px;z-index:19}.tabs .tab-btn{appearance:none;border:1px solid var(--border);background:#fff;padding:10px 12px;border-radius:10px 10px 0 0;cursor:pointer;box-shadow:var(--shadow);margin-left:8px;margin-top:8px}.tabs .tab-btn[aria-selected=true]{background:var(--chip);border-color:var(--chipBorder)}.tabs .tab-btn{padding:12px 24px;border:none;background:#f8fafc;cursor:pointer;border-radius:8px 8px 0 0;font-weight:500;color:var(--muted);transition:all .2s}.tabs .tab-btn[aria-selected=true]{background:#fff;color:#1f2937;border-bottom:2px solid #3b82f6}.tabs .tab-btn:hover{background:#e2e8f0}.tabs .tab-help{background:linear-gradient(135deg, #10b981, #059669) !important;color:#fff !important;font-weight:600;box-shadow:0 2px 4px rgba(16,185,129,.3)}.tabs .tab-help:hover{background:linear-gradient(135deg, #059669, #047857) !important;transform:translateY(-1px);box-shadow:0 4px 8px rgba(16,185,129,.4)}.tabs .tab-help[aria-selected=true]{background:linear-gradient(135deg, #047857, #065f46) !important;border-bottom:2px solid #10b981}.container{display:grid;grid-template-columns:340px 1fr;gap:16px;padding:16px}#tabHelpWrap .container{grid-template-columns:1fr}.panel{background:var(--panel);border:1px solid var(--border);border-radius:var(--radius);padding:14px;box-shadow:var(--shadow)}.panel h2{margin:0 0 8px;font-size:15px;opacity:.95}.controls{display:flex;gap:12px;flex-direction:column}.controls label{font-size:13px;color:var(--muted)}input[type=text],textarea,select{width:100%;background:#fff;color:var(--text);border:1px solid var(--border);border-radius:12px;padding:10px 12px;resize:vertical;box-shadow:inset 0 1px 0 rgba(2,8,23,.03);box-sizing:border-box}textarea{min-height:88px}button,.btn{background:#fff;color:var(--text);border:1px solid var(--border);border-radius:12px;padding:10px 12px;cursor:pointer;box-shadow:var(--shadow)}button:hover,.btn:hover{border-color:#cbd5e1;box-shadow:var(--shadow-lg)}button.btn-success,.btn.btn-success{background:var(--accent-2);color:#fff;border-color:#15803d}button.btn-danger,.btn.btn-danger{background:var(--danger);color:#fff;border-color:#b91c1c}.error-chip{display:inline-flex;align-items:center;gap:6px;padding:6px 10px;border:1px solid var(--chipBorder);background:var(--chip);color:var(--chipText);border-radius:999px;font-size:13px;cursor:pointer;user-select:none}.error-chip[data-active=true]{outline:2px solid rgba(37,99,235,.25)}.error-chip b{min-width:1.6em;text-align:center}.error-group{display:flex;flex-wrap:wrap;gap:8px}.list{display:flex;flex-direction:column;gap:10px}.block{background:#fff;border:1px solid var(--border);border-radius:var(--radius);padding:12px;display:flex;flex-direction:column;gap:10px}.block .meta{display:flex;gap:8px;align-items:center;flex-wrap:wrap;font-size:13px;color:var(--muted)}.block .meta .tag{background:#f1f5f9;padding:4px 9px;border-radius:999px;border:1px solid var(--border)}.block .text{white-space:pre-wrap;font-size:15px}.sblock{background:#fff;border:1px solid var(--border);border-radius:12px;padding:12px;display:flex;flex-direction:column;gap:6px}.sblock .meta{display:flex;gap:8px;align-items:center;flex-wrap:wrap;font-size:13px;color:var(--muted)}.sblock .meta .tag{background:#f1f5f9;padding:4px 9px;border-radius:999px;border:1px solid var(--border)}.sblock .s-title{font-weight:bold;margin-bottom:8px;color:#1f2937}.sblock .s-text{white-space:pre-wrap;font-size:15px}.kpis{display:grid;grid-template-columns:repeat(2, minmax(0, 1fr));gap:10px}.kpi{background:#fff;border:1px solid var(--border);border-radius:12px;padding:12px}.kpi h3{margin:0;font-size:12px;color:var(--muted)}.kpi .num{font-size:22px;font-weight:700}.summary{display:flex;flex-direction:column;gap:8px}.summary table{width:100%;border-collapse:collapse;font-size:14px}.summary table th,.summary table td{text-align:left;padding:8px;border-bottom:1px solid var(--border)}.summary table tbody tr:hover{background:#f8fafc}.pill{padding:4px 8px;border-radius:999px;background:#f8fafc;border:1px solid var(--border)}.muted{color:var(--muted)}.row{display:flex;gap:8px;align-items:center}.spacer{flex:1}.hidden{display:none !important}.small{font-size:12px}details>summary{cursor:pointer;color:var(--muted)}.note{background:#f8fafc;border-radius:10px;border:1px dashed var(--border);padding:8px;overflow-x:auto}.quiet-box{background:#f8fafc;border:1px dashed var(--border);padding:10px;border-radius:10px}.footer-fixed{position:fixed;left:0;right:0;bottom:0;background:#fff;border-top:1px solid var(--border);box-shadow:0 -6px 12px rgba(2,8,23,.05);z-index:30}.footer-fixed .footer-bar{display:flex;align-items:center;gap:10px;padding:10px 16px}.footer-fixed .footer-bar .badge{background:#eef2ff;border:1px solid #c7d2fe;border-radius:999px;padding:4px 10px;font-size:13px}.footer-fixed .footer-panel{display:none;padding:12px 16px;border-top:1px solid var(--border)}.footer-fixed.open .footer-panel{display:block}#save{display:none !important}.main-content-scroll{max-height:100vh;overflow-y:auto;padding-right:8px}.legend-toggle,.source-toggle{display:flex;align-items:center;cursor:pointer;user-select:none;font-weight:500;color:#007bff;margin-top:1.5em;margin-bottom:.2em}.legend-toggle .legend-chevron,.source-toggle .legend-chevron{display:inline-block;transition:transform .2s;margin-right:7px;font-size:1.2em}.legend-toggle .legend-chevron.open,.source-toggle .legend-chevron.open{transform:rotate(90deg)}.source-toggle{padding-left:.5rem;justify-content:start;gap:5rem}.source-toggle summary{color:green}#sidebar-legend-content{display:none;margin-bottom:1.2em;background:#f7fafc;border:1px solid #e1e6ed;border-radius:7px;padding:12px 16px 10px 16px}#sidebar-legend-content.open{display:block}.help-content{max-width:800px}.help-content .help-section{margin-bottom:2rem;padding:1.5rem;background:#f8fafc;border-radius:12px;border:1px solid var(--border)}.help-content .help-section h3{color:#1f2937;margin-bottom:1rem;font-size:1.2rem;font-weight:600}.help-content .help-section h4{color:#374151;margin:1.5rem 0 .5rem 0;font-size:1rem;font-weight:600}.help-content .help-section ol,.help-content .help-section ul{margin:.5rem 0;padding-left:1.5rem}.help-content .help-section ol li,.help-content .help-section ul li{margin-bottom:.5rem;line-height:1.6}.help-content .help-section .ejemplo-url{display:block;margin-top:.5rem;font-size:.9rem;color:var(--muted)}.help-content .help-section .ejemplo-url code{background:#e5e7eb;padding:2px 6px;border-radius:4px;font-family:"Courier New",monospace;font-size:.85rem;word-break:break-all}.help-content .help-section .info-tip{background:#dbeafe;border:1px solid #93c5fd;border-radius:8px;padding:1rem;margin-top:1rem;color:#1e40af}.help-content .help-section .info-tip b{color:#1d4ed8}.help-content .help-section kbd{background:#374151;color:#fff;padding:2px 6px;border-radius:4px;font-family:"Courier New",monospace;font-size:.85rem;font-weight:bold}`, ""]);
// Exports
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (___CSS_LOADER_EXPORT___);


/***/ }),

/***/ 314:
/***/ ((module) => {



/*
  MIT License http://www.opensource.org/licenses/mit-license.php
  Author Tobias Koppers @sokra
*/
module.exports = function (cssWithMappingToString) {
  var list = [];

  // return the list of modules as css string
  list.toString = function toString() {
    return this.map(function (item) {
      var content = "";
      var needLayer = typeof item[5] !== "undefined";
      if (item[4]) {
        content += "@supports (".concat(item[4], ") {");
      }
      if (item[2]) {
        content += "@media ".concat(item[2], " {");
      }
      if (needLayer) {
        content += "@layer".concat(item[5].length > 0 ? " ".concat(item[5]) : "", " {");
      }
      content += cssWithMappingToString(item);
      if (needLayer) {
        content += "}";
      }
      if (item[2]) {
        content += "}";
      }
      if (item[4]) {
        content += "}";
      }
      return content;
    }).join("");
  };

  // import a list of modules into the list
  list.i = function i(modules, media, dedupe, supports, layer) {
    if (typeof modules === "string") {
      modules = [[null, modules, undefined]];
    }
    var alreadyImportedModules = {};
    if (dedupe) {
      for (var k = 0; k < this.length; k++) {
        var id = this[k][0];
        if (id != null) {
          alreadyImportedModules[id] = true;
        }
      }
    }
    for (var _k = 0; _k < modules.length; _k++) {
      var item = [].concat(modules[_k]);
      if (dedupe && alreadyImportedModules[item[0]]) {
        continue;
      }
      if (typeof layer !== "undefined") {
        if (typeof item[5] === "undefined") {
          item[5] = layer;
        } else {
          item[1] = "@layer".concat(item[5].length > 0 ? " ".concat(item[5]) : "", " {").concat(item[1], "}");
          item[5] = layer;
        }
      }
      if (media) {
        if (!item[2]) {
          item[2] = media;
        } else {
          item[1] = "@media ".concat(item[2], " {").concat(item[1], "}");
          item[2] = media;
        }
      }
      if (supports) {
        if (!item[4]) {
          item[4] = "".concat(supports);
        } else {
          item[1] = "@supports (".concat(item[4], ") {").concat(item[1], "}");
          item[4] = supports;
        }
      }
      list.push(item);
    }
  };
  return list;
};

/***/ }),

/***/ 540:
/***/ ((module) => {



/* istanbul ignore next  */
function insertStyleElement(options) {
  var element = document.createElement("style");
  options.setAttributes(element, options.attributes);
  options.insert(element, options.options);
  return element;
}
module.exports = insertStyleElement;

/***/ }),

/***/ 601:
/***/ ((module) => {



module.exports = function (i) {
  return i[1];
};

/***/ }),

/***/ 659:
/***/ ((module) => {



var memo = {};

/* istanbul ignore next  */
function getTarget(target) {
  if (typeof memo[target] === "undefined") {
    var styleTarget = document.querySelector(target);

    // Special case to return head of iframe instead of iframe itself
    if (window.HTMLIFrameElement && styleTarget instanceof window.HTMLIFrameElement) {
      try {
        // This will throw an exception if access to iframe is blocked
        // due to cross-origin restrictions
        styleTarget = styleTarget.contentDocument.head;
      } catch (e) {
        // istanbul ignore next
        styleTarget = null;
      }
    }
    memo[target] = styleTarget;
  }
  return memo[target];
}

/* istanbul ignore next  */
function insertBySelector(insert, style) {
  var target = getTarget(insert);
  if (!target) {
    throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");
  }
  target.appendChild(style);
}
module.exports = insertBySelector;

/***/ }),

/***/ 825:
/***/ ((module) => {



/* istanbul ignore next  */
function apply(styleElement, options, obj) {
  var css = "";
  if (obj.supports) {
    css += "@supports (".concat(obj.supports, ") {");
  }
  if (obj.media) {
    css += "@media ".concat(obj.media, " {");
  }
  var needLayer = typeof obj.layer !== "undefined";
  if (needLayer) {
    css += "@layer".concat(obj.layer.length > 0 ? " ".concat(obj.layer) : "", " {");
  }
  css += obj.css;
  if (needLayer) {
    css += "}";
  }
  if (obj.media) {
    css += "}";
  }
  if (obj.supports) {
    css += "}";
  }
  var sourceMap = obj.sourceMap;
  if (sourceMap && typeof btoa !== "undefined") {
    css += "\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(sourceMap)))), " */");
  }

  // For old IE
  /* istanbul ignore if  */
  options.styleTagTransform(css, styleElement, options.options);
}
function removeStyleElement(styleElement) {
  // istanbul ignore if
  if (styleElement.parentNode === null) {
    return false;
  }
  styleElement.parentNode.removeChild(styleElement);
}

/* istanbul ignore next  */
function domAPI(options) {
  if (typeof document === "undefined") {
    return {
      update: function update() {},
      remove: function remove() {}
    };
  }
  var styleElement = options.insertStyleElement(options);
  return {
    update: function update(obj) {
      apply(styleElement, options, obj);
    },
    remove: function remove() {
      removeStyleElement(styleElement);
    }
  };
}
module.exports = domAPI;

/***/ })

/******/ 	});
/************************************************************************/
/******/ 	// The module cache
/******/ 	var __webpack_module_cache__ = {};
/******/ 	
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/ 		// Check if module is in cache
/******/ 		var cachedModule = __webpack_module_cache__[moduleId];
/******/ 		if (cachedModule !== undefined) {
/******/ 			return cachedModule.exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = __webpack_module_cache__[moduleId] = {
/******/ 			id: moduleId,
/******/ 			// no module.loaded needed
/******/ 			exports: {}
/******/ 		};
/******/ 	
/******/ 		// Execute the module function
/******/ 		__webpack_modules__[moduleId](module, module.exports, __webpack_require__);
/******/ 	
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/ 	
/************************************************************************/
/******/ 	/* webpack/runtime/compat get default export */
/******/ 	(() => {
/******/ 		// getDefaultExport function for compatibility with non-harmony modules
/******/ 		__webpack_require__.n = (module) => {
/******/ 			var getter = module && module.__esModule ?
/******/ 				() => (module['default']) :
/******/ 				() => (module);
/******/ 			__webpack_require__.d(getter, { a: getter });
/******/ 			return getter;
/******/ 		};
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/define property getters */
/******/ 	(() => {
/******/ 		// define getter functions for harmony exports
/******/ 		__webpack_require__.d = (exports, definition) => {
/******/ 			for(var key in definition) {
/******/ 				if(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {
/******/ 					Object.defineProperty(exports, key, { enumerable: true, get: definition[key] });
/******/ 				}
/******/ 			}
/******/ 		};
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/hasOwnProperty shorthand */
/******/ 	(() => {
/******/ 		__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/nonce */
/******/ 	(() => {
/******/ 		__webpack_require__.nc = undefined;
/******/ 	})();
/******/ 	
/************************************************************************/
var __webpack_exports__ = {};

// EXTERNAL MODULE: ./node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js
var injectStylesIntoStyleTag = __webpack_require__(72);
var injectStylesIntoStyleTag_default = /*#__PURE__*/__webpack_require__.n(injectStylesIntoStyleTag);
// EXTERNAL MODULE: ./node_modules/style-loader/dist/runtime/styleDomAPI.js
var styleDomAPI = __webpack_require__(825);
var styleDomAPI_default = /*#__PURE__*/__webpack_require__.n(styleDomAPI);
// EXTERNAL MODULE: ./node_modules/style-loader/dist/runtime/insertBySelector.js
var insertBySelector = __webpack_require__(659);
var insertBySelector_default = /*#__PURE__*/__webpack_require__.n(insertBySelector);
// EXTERNAL MODULE: ./node_modules/style-loader/dist/runtime/setAttributesWithoutAttributes.js
var setAttributesWithoutAttributes = __webpack_require__(56);
var setAttributesWithoutAttributes_default = /*#__PURE__*/__webpack_require__.n(setAttributesWithoutAttributes);
// EXTERNAL MODULE: ./node_modules/style-loader/dist/runtime/insertStyleElement.js
var insertStyleElement = __webpack_require__(540);
var insertStyleElement_default = /*#__PURE__*/__webpack_require__.n(insertStyleElement);
// EXTERNAL MODULE: ./node_modules/style-loader/dist/runtime/styleTagTransform.js
var styleTagTransform = __webpack_require__(113);
var styleTagTransform_default = /*#__PURE__*/__webpack_require__.n(styleTagTransform);
// EXTERNAL MODULE: ./node_modules/css-loader/dist/cjs.js!./node_modules/sass-loader/dist/cjs.js!./src/css/styles.scss
var styles = __webpack_require__(164);
;// ./src/css/styles.scss

      
      
      
      
      
      
      
      
      

var options = {};

options.styleTagTransform = (styleTagTransform_default());
options.setAttributes = (setAttributesWithoutAttributes_default());
options.insert = insertBySelector_default().bind(null, "head");
options.domAPI = (styleDomAPI_default());
options.insertStyleElement = (insertStyleElement_default());

var update = injectStylesIntoStyleTag_default()(styles/* default */.A, options);




       /* harmony default export */ const css_styles = (styles/* default */.A && styles/* default */.A.locals ? styles/* default */.A.locals : undefined);

;// ./src/js/utils.js
function _slicedToArray(r, e) { return _arrayWithHoles(r) || _iterableToArrayLimit(r, e) || _unsupportedIterableToArray(r, e) || _nonIterableRest(); }
function _nonIterableRest() { throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }
function _unsupportedIterableToArray(r, a) { if (r) { if ("string" == typeof r) return _arrayLikeToArray(r, a); var t = {}.toString.call(r).slice(8, -1); return "Object" === t && r.constructor && (t = r.constructor.name), "Map" === t || "Set" === t ? Array.from(r) : "Arguments" === t || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t) ? _arrayLikeToArray(r, a) : void 0; } }
function _arrayLikeToArray(r, a) { (null == a || a > r.length) && (a = r.length); for (var e = 0, n = Array(a); e < a; e++) n[e] = r[e]; return n; }
function _iterableToArrayLimit(r, l) { var t = null == r ? null : "undefined" != typeof Symbol && r[Symbol.iterator] || r["@@iterator"]; if (null != t) { var e, n, i, u, a = [], f = !0, o = !1; try { if (i = (t = t.call(r)).next, 0 === l) { if (Object(t) !== t) return; f = !1; } else for (; !(f = (e = i.call(t)).done) && (a.push(e.value), a.length !== l); f = !0); } catch (r) { o = !0, n = r; } finally { try { if (!f && null != t["return"] && (u = t["return"](), Object(u) !== u)) return; } finally { if (o) throw n; } } return a; } }
function _arrayWithHoles(r) { if (Array.isArray(r)) return r; }
// Utilidades generales
var utils_$ = function $(sel) {
  return document.querySelector(sel);
};
var utils_el = function el(tag) {
  var attrs = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};
  var n = document.createElement(tag);
  Object.entries(attrs).forEach(function (_ref) {
    var _ref2 = _slicedToArray(_ref, 2),
      k = _ref2[0],
      v = _ref2[1];
    if (k === 'dataset') Object.entries(v).forEach(function (_ref3) {
      var _ref4 = _slicedToArray(_ref3, 2),
        dk = _ref4[0],
        dv = _ref4[1];
      return n.dataset[dk] = dv;
    });else if (k.startsWith('on') && typeof v === 'function') n.addEventListener(k.slice(2), v);else if (k === 'html') n.innerHTML = v;else n.setAttribute(k, v);
  });
  for (var _len = arguments.length, children = new Array(_len > 2 ? _len - 2 : 0), _key = 2; _key < _len; _key++) {
    children[_key - 2] = arguments[_key];
  }
  children.flat().forEach(function (c) {
    return n.append(c instanceof Node ? c : document.createTextNode(c));
  });
  return n;
};
var utils_safe = function safe(v) {
  return v == null ? '' : String(v);
};
function utils_csvEscape(v) {
  var s = String(v !== null && v !== void 0 ? v : '');
  if (s.includes(',') || s.includes('\n') || s.includes('"')) return '"' + s.replace(/"/g, '""') + '"';
  return s;
}
function utils_secondsToTimestamp(secs) {
  var h = Math.floor(secs / 3600);
  var m = Math.floor(secs % 3600 / 60);
  var s = secs % 60;
  return (h > 0 ? String(h).padStart(2, '0') + ':' : '') + String(m).padStart(2, '0') + ':' + String(s).padStart(2, '0');
}

// Exponer funciones globalmente
window.$ = utils_$;
window.el = utils_el;
window.safe = utils_safe;
window.csvEscape = utils_csvEscape;
window.secondsToTimestamp = utils_secondsToTimestamp;
;// ./src/js/storage.js
function _typeof(o) { "@babel/helpers - typeof"; return _typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (o) { return typeof o; } : function (o) { return o && "function" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? "symbol" : typeof o; }, _typeof(o); }
function _toConsumableArray(r) { return _arrayWithoutHoles(r) || _iterableToArray(r) || storage_unsupportedIterableToArray(r) || _nonIterableSpread(); }
function _nonIterableSpread() { throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }
function storage_unsupportedIterableToArray(r, a) { if (r) { if ("string" == typeof r) return storage_arrayLikeToArray(r, a); var t = {}.toString.call(r).slice(8, -1); return "Object" === t && r.constructor && (t = r.constructor.name), "Map" === t || "Set" === t ? Array.from(r) : "Arguments" === t || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t) ? storage_arrayLikeToArray(r, a) : void 0; } }
function _iterableToArray(r) { if ("undefined" != typeof Symbol && null != r[Symbol.iterator] || null != r["@@iterator"]) return Array.from(r); }
function _arrayWithoutHoles(r) { if (Array.isArray(r)) return storage_arrayLikeToArray(r); }
function storage_arrayLikeToArray(r, a) { (null == a || a > r.length) && (a = r.length); for (var e = 0, n = Array(a); e < a; e++) n[e] = r[e]; return n; }
function ownKeys(e, r) { var t = Object.keys(e); if (Object.getOwnPropertySymbols) { var o = Object.getOwnPropertySymbols(e); r && (o = o.filter(function (r) { return Object.getOwnPropertyDescriptor(e, r).enumerable; })), t.push.apply(t, o); } return t; }
function _objectSpread(e) { for (var r = 1; r < arguments.length; r++) { var t = null != arguments[r] ? arguments[r] : {}; r % 2 ? ownKeys(Object(t), !0).forEach(function (r) { _defineProperty(e, r, t[r]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys(Object(t)).forEach(function (r) { Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r)); }); } return e; }
function _defineProperty(e, r, t) { return (r = _toPropertyKey(r)) in e ? Object.defineProperty(e, r, { value: t, enumerable: !0, configurable: !0, writable: !0 }) : e[r] = t, e; }
function _toPropertyKey(t) { var i = _toPrimitive(t, "string"); return "symbol" == _typeof(i) ? i : i + ""; }
function _toPrimitive(t, r) { if ("object" != _typeof(t) || !t) return t; var e = t[Symbol.toPrimitive]; if (void 0 !== e) { var i = e.call(t, r || "default"); if ("object" != _typeof(i)) return i; throw new TypeError("@@toPrimitive must return a primitive value."); } return ("string" === r ? String : Number)(t); }
// Almacenamiento local
var storage_LS_T = 'auditor_trans_v1';
var storage_LS_S = 'auditor_synth_v1';
var storage_LS_TITLE = 'auditor_meeting_title_v1';
var LS_SYNTH_GLOBAL_OLD = 'auditor_synth_global_v1'; // Para migraci√≥n

function storage_loadFromLocal() {
  try {
    var rawT = localStorage.getItem(storage_LS_T);
    if (rawT) {
      var p = JSON.parse(rawT);
      Object.assign(stateT, p, {
        enabledErrors: new Set(p.enabledErrors)
      });
    }
    var rawS = localStorage.getItem(storage_LS_S);
    if (rawS) {
      var _p = JSON.parse(rawS);
      Object.assign(stateS, _p, {
        enabledErrors: new Set(_p.enabledErrors)
      });
    }

    // Cargar t√≠tulo de la reuni√≥n
    var savedTitle = localStorage.getItem(storage_LS_TITLE);
    if (savedTitle) {
      setMeetingTitle(savedTitle);
    }

    // Migrar globalSynthText desde el localStorage separado (si existe)
    var oldGlobalSynth = localStorage.getItem(LS_SYNTH_GLOBAL_OLD);
    if (oldGlobalSynth && !stateS.globalSynthText) {
      stateS.globalSynthText = oldGlobalSynth;
      // Guardar en el nuevo formato y eliminar el antiguo
      storage_saveToLocal();
      localStorage.removeItem(LS_SYNTH_GLOBAL_OLD);
    }
  } catch (e) {
    console.warn(e);
  }
}
function storage_saveToLocal() {
  localStorage.setItem(storage_LS_T, JSON.stringify(_objectSpread(_objectSpread({}, stateT), {}, {
    enabledErrors: _toConsumableArray(stateT.enabledErrors)
  })));
  localStorage.setItem(storage_LS_S, JSON.stringify(_objectSpread(_objectSpread({}, stateS), {}, {
    enabledErrors: _toConsumableArray(stateS.enabledErrors)
  })));
  localStorage.setItem(storage_LS_TITLE, meetingTitle);
}

// Exponer funciones globalmente
window.LS_T = storage_LS_T;
window.LS_S = storage_LS_S;
window.LS_TITLE = storage_LS_TITLE;
window.loadFromLocal = storage_loadFromLocal;
window.saveToLocal = storage_saveToLocal;
;// ./src/js/filters.js
// Filtros de b√∫squeda
function filters_blockMatchesFilterT(b, f) {
  if (!f) return true;
  var k = f.toLowerCase();
  return (b.speaker || '').toLowerCase().includes(k) || (b.text || '').toLowerCase().includes(k);
}
function filters_blockMatchesFilterS(b, f) {
  if (!f) return true;
  var k = f.toLowerCase();
  return (b.title || '').toLowerCase().includes(k) || (b.text || '').toLowerCase().includes(k);
}

// Exponer funciones globalmente
window.blockMatchesFilterT = filters_blockMatchesFilterT;
window.blockMatchesFilterS = filters_blockMatchesFilterS;
;// ./src/js/render.js
function render_slicedToArray(r, e) { return render_arrayWithHoles(r) || render_iterableToArrayLimit(r, e) || render_unsupportedIterableToArray(r, e) || render_nonIterableRest(); }
function render_nonIterableRest() { throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }
function render_unsupportedIterableToArray(r, a) { if (r) { if ("string" == typeof r) return render_arrayLikeToArray(r, a); var t = {}.toString.call(r).slice(8, -1); return "Object" === t && r.constructor && (t = r.constructor.name), "Map" === t || "Set" === t ? Array.from(r) : "Arguments" === t || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t) ? render_arrayLikeToArray(r, a) : void 0; } }
function render_arrayLikeToArray(r, a) { (null == a || a > r.length) && (a = r.length); for (var e = 0, n = Array(a); e < a; e++) n[e] = r[e]; return n; }
function render_iterableToArrayLimit(r, l) { var t = null == r ? null : "undefined" != typeof Symbol && r[Symbol.iterator] || r["@@iterator"]; if (null != t) { var e, n, i, u, a = [], f = !0, o = !1; try { if (i = (t = t.call(r)).next, 0 === l) { if (Object(t) !== t) return; f = !1; } else for (; !(f = (e = i.call(t)).done) && (a.push(e.value), a.length !== l); f = !0); } catch (r) { o = !0, n = r; } finally { try { if (!f && null != t["return"] && (u = t["return"](), Object(u) !== u)) return; } finally { if (o) throw n; } } return a; } }
function render_arrayWithHoles(r) { if (Array.isArray(r)) return r; }
// Renderizado de UI y componentes
function getCtx(tab) {
  return tab === 'S' ? {
    state: stateS,
    catalog: ERROR_CATALOG_S,
    q: $('#qS'),
    toggles: $('#errorsTogglesS'),
    list: $('#listS'),
    kpiBlocks: $('#kpiBlocksS'),
    kpiBlocksErr: $('#kpiBlocksErrS'),
    kpiErr: $('#kpiErrS'),
    kpiTypes: $('#kpiTypesS'),
    kpiWords: $('#kpiWordsS'),
    summary: $('#summaryS')
  } : {
    state: stateT,
    catalog: ERROR_CATALOG_T,
    q: $('#qT'),
    toggles: $('#errorsTogglesT'),
    list: $('#listT'),
    kpiBlocks: $('#kpiBlocksT'),
    kpiBlocksErr: $('#kpiBlocksErrT'),
    kpiErr: $('#kpiErrT'),
    kpiTypes: $('#kpiTypesT'),
    kpiWords: $('#kpiWordsT'),
    summary: $('#summaryT')
  };
}
function render_countWordsInTranscription(data) {
  if (!Array.isArray(data)) return 0;
  return data.reduce(function (acc, item) {
    if (typeof item.text === 'string') {
      acc += (item.text.trim().match(/\S+/g) || []).length;
    }
    return acc;
  }, 0);
}
function timePill(start, end) {
  var meetingDate = getMeetingDate();
  var pill = '';
  if (meetingDate && start && start !== 'undefined' && start !== '') {
    try {
      var startSecs = getBiteOffsetSeconds(start, meetingDate);
      if (!isNaN(startSecs) && isFinite(startSecs)) {
        pill += secondsToTimestamp(startSecs);
      } else {
        pill += start;
      }
    } catch (error) {
      console.warn('Error calculating start timestamp:', error);
      pill += start;
    }
  } else {
    pill += start !== null && start !== void 0 ? start : '¬ø?';
  }
  if (meetingDate && end && end !== 'undefined' && end !== '') {
    try {
      var endSecs = getBiteOffsetSeconds(end, meetingDate);
      if (!isNaN(endSecs) && isFinite(endSecs)) {
        pill += ' ‚Üí ' + secondsToTimestamp(endSecs);
      } else if (end) {
        pill += ' ‚Üí ' + end;
      }
    } catch (error) {
      console.warn('Error calculating end timestamp:', error);
      if (end) {
        pill += ' ‚Üí ' + end;
      }
    }
  } else if (end) {
    pill += ' ‚Üí ' + end;
  }
  return el('span', {
    "class": 'tag'
  }, pill);
}
function render_render() {
  var tab = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : activeTab;
  var ctx = getCtx(tab);
  // toggles
  ctx.toggles.innerHTML = '';
  ctx.catalog.forEach(function (err) {
    var active = (tab === 'S' ? stateS : stateT).enabledErrors.has(err.key);
    var chip = el('span', {
      "class": 'error-chip',
      title: err.desc,
      dataset: {
        active: active
      }
    }, el('b', {}, active ? '‚úì' : '‚Ä¢'), ' ', err.label);
    chip.addEventListener('click', function () {
      return toggleErrorType(tab, err.key);
    });
    ctx.toggles.append(chip);
  });
  ctx.kpiTypes.textContent = (tab === 'S' ? stateS : stateT).enabledErrors.size;
  // lista
  ctx.list.innerHTML = '';
  if (tab === 'S') {
    stateS.items.forEach(function (b, i) {
      if (!blockMatchesFilterS(b, stateS.filter)) return;
      var ann = stateS.annotations[i] || {
        counts: {},
        note: '',
        open: false
      };
      var chips = el('div', {
        "class": 'error-group'
      });
      ERROR_CATALOG_S.forEach(function (err) {
        if (!stateS.enabledErrors.has(err.key)) return;
        var count = ann.counts[err.key] || 0;
        var chip = el('span', {
          "class": 'error-chip',
          title: err.desc
        });
        chip.append(el('b', {}, String(count)), ' ', err.label);
        chip.addEventListener('click', function (e) {
          var alt = e.altKey || e.metaKey;
          incrementError('S', i, err.key, alt ? -1 : +1);
        });
        chips.append(chip);
      });
      var noteArea = el('textarea', {
        "class": ann.open ? '' : 'hidden',
        placeholder: 'A√±ade una nota para este bloque‚Ä¶'
      });
      noteArea.value = ann.note || '';
      noteArea.addEventListener('input', function () {
        return setNote('S', i, noteArea.value);
      });
      // Agregar header con timestamp para s√≠ntesis, similar a transcripci√≥n
      var header = el('div', {
        "class": 'meta'
      }, el('span', {
        "class": 's-title'
      }, safe(b.title) || 'Sin t√≠tulo'), timePill(b.start, b.end));
      var block = el('li', {
        "class": 'sblock'
      }, header, el('div', {
        "class": 's-text'
      }, safe(b.text) || ''), el('div', {
        "class": 'row'
      }, chips, el('span', {
        "class": 'spacer'
      }), el('button', {
        "class": 'btn small',
        onclick: function onclick() {
          return toggleNote('S', i);
        }
      }, ann.open ? 'Ocultar nota' : 'A√±adir nota')), noteArea);
      ctx.list.append(block);
    });
    // KPIs
    var totalErr = 0,
      blocksErr = 0;
    stateS.items.forEach(function (_, i) {
      var _stateS$annotations$i;
      var c = ((_stateS$annotations$i = stateS.annotations[i]) === null || _stateS$annotations$i === void 0 ? void 0 : _stateS$annotations$i.counts) || {};
      var s = Object.values(c).reduce(function (a, b) {
        return a + (b || 0);
      }, 0);
      if (s > 0) blocksErr++;
      totalErr += s;
    });
    ctx.kpiBlocks.textContent = stateS.items.length;
    ctx.kpiBlocksErr.textContent = blocksErr;
    ctx.kpiErr.textContent = totalErr;
    ctx.kpiWords.textContent = render_countWordsInTranscription(stateS.items);
    // resumen
    ctx.summary.innerHTML = '';
    var tHead = el('div', {
      "class": 'row',
      style: 'margin:8px 0'
    }, el('span', {
      "class": 'muted small'
    }, 'Totales por tipo de error (S√≠ntesis)'));
    ctx.summary.append(tHead);
    var tbl = el('table');
    tbl.append(el('thead', {}, el('tr', {}, el('th', {}, 'Tipo'), el('th', {}, 'Total'))));
    var tb = el('tbody');
    ERROR_CATALOG_S.forEach(function (err) {
      var tot = stateS.items.reduce(function (acc, _, i) {
        var _stateS$annotations$i2;
        return acc + (((_stateS$annotations$i2 = stateS.annotations[i]) === null || _stateS$annotations$i2 === void 0 || (_stateS$annotations$i2 = _stateS$annotations$i2.counts) === null || _stateS$annotations$i2 === void 0 ? void 0 : _stateS$annotations$i2[err.key]) || 0);
      }, 0);
      tb.append(el('tr', {}, el('td', {}, err.label), el('td', {}, String(tot))));
    });
    tbl.append(tb);
    ctx.summary.append(tbl);
  } else {
    stateT.items.forEach(function (b, i) {
      if (!blockMatchesFilterT(b, stateT.filter)) return;
      var ann = stateT.annotations[i] || {
        counts: {},
        note: '',
        open: false
      };
      var chips = el('div', {
        "class": 'error-group'
      });
      ERROR_CATALOG_T.forEach(function (err) {
        if (!stateT.enabledErrors.has(err.key)) return;
        var count = ann.counts[err.key] || 0;
        var chip = el('span', {
          "class": 'error-chip',
          title: err.desc
        });
        chip.append(el('b', {}, String(count)), ' ', err.label);
        chip.addEventListener('click', function (e) {
          var alt = e.altKey || e.metaKey;
          incrementError('T', i, err.key, alt ? -1 : +1);
        });
        chips.append(chip);
      });
      var noteArea = el('textarea', {
        "class": ann.open ? '' : 'hidden',
        placeholder: 'A√±ade una nota para este bloque‚Ä¶'
      });
      noteArea.value = ann.note || '';
      noteArea.addEventListener('input', function () {
        return setNote('T', i, noteArea.value);
      });
      var header = el('div', {
        "class": 'meta'
      }, el('span', {
        "class": 'tag'
      }, b.speaker || '¬øHablante?'), timePill(b.start, b.end));
      var block = el('li', {
        "class": 'block'
      }, header, el('div', {
        "class": 'text'
      }, b.text || ''), el('div', {
        "class": 'row'
      }, chips, el('span', {
        "class": 'spacer'
      }), el('button', {
        "class": 'btn small',
        onclick: function onclick() {
          return toggleNote('T', i);
        }
      }, ann.open ? 'Ocultar nota' : 'A√±adir nota')), noteArea);
      ctx.list.append(block);
    });
    // KPIs
    var _totalErr = 0,
      _blocksErr = 0;
    stateT.items.forEach(function (_, i) {
      var _stateT$annotations$i;
      var c = ((_stateT$annotations$i = stateT.annotations[i]) === null || _stateT$annotations$i === void 0 ? void 0 : _stateT$annotations$i.counts) || {};
      var s = Object.values(c).reduce(function (a, b) {
        return a + (b || 0);
      }, 0);
      if (s > 0) _blocksErr++;
      _totalErr += s;
    });
    ctx.kpiBlocks.textContent = stateT.items.length;
    ctx.kpiBlocksErr.textContent = _blocksErr;
    ctx.kpiErr.textContent = _totalErr;
    ctx.kpiWords.textContent = render_countWordsInTranscription(stateT.items);
    // resumen
    ctx.summary.innerHTML = '';
    var _tHead = el('div', {
      "class": 'row',
      style: 'margin:8px 0'
    }, el('span', {
      "class": 'muted small'
    }, 'Totales por tipo de error (Transcripci√≥n)'));
    ctx.summary.append(_tHead);
    var _tbl = el('table');
    _tbl.append(el('thead', {}, el('tr', {}, el('th', {}, 'Tipo'), el('th', {}, 'Total'))));
    var _tb = el('tbody');
    ERROR_CATALOG_T.forEach(function (err) {
      var tot = stateT.items.reduce(function (acc, _, i) {
        var _stateT$annotations$i2;
        return acc + (((_stateT$annotations$i2 = stateT.annotations[i]) === null || _stateT$annotations$i2 === void 0 || (_stateT$annotations$i2 = _stateT$annotations$i2.counts) === null || _stateT$annotations$i2 === void 0 ? void 0 : _stateT$annotations$i2[err.key]) || 0);
      }, 0);
      _tb.append(el('tr', {}, el('td', {}, err.label), el('td', {}, String(tot))));
    });
    _tbl.append(_tb);
    ctx.summary.append(_tbl);
  }
}
function render_renderAll() {
  render_render('T');
  render_render('S');
  render_renderFooterTotals();
}
function render_totalsByType(tab) {
  var st = tab === 'S' ? stateS : stateT;
  var cat = tab === 'S' ? ERROR_CATALOG_S : ERROR_CATALOG_T;
  var totals = {};
  cat.forEach(function (e) {
    return totals[e.key] = 0;
  });
  st.items.forEach(function (_, i) {
    var _st$annotations$i;
    var c = ((_st$annotations$i = st.annotations[i]) === null || _st$annotations$i === void 0 ? void 0 : _st$annotations$i.counts) || {};
    Object.entries(c).forEach(function (_ref) {
      var _ref2 = render_slicedToArray(_ref, 2),
        k = _ref2[0],
        v = _ref2[1];
      return totals[k] = (totals[k] || 0) + (v || 0);
    });
  });
  return totals;
}
function totalsCombined() {
  var tTot = Object.values(render_totalsByType('T')).reduce(function (a, b) {
    return a + b;
  }, 0);
  var sTot = Object.values(render_totalsByType('S')).reduce(function (a, b) {
    return a + b;
  }, 0);
  var tBlocks = stateT.items.reduce(function (acc, _, i) {
    var _stateT$annotations$i3;
    return acc + (Object.values(((_stateT$annotations$i3 = stateT.annotations[i]) === null || _stateT$annotations$i3 === void 0 ? void 0 : _stateT$annotations$i3.counts) || {}).reduce(function (x, y) {
      return x + (y || 0);
    }, 0) > 0 ? 1 : 0);
  }, 0);
  var sBlocks = stateS.items.reduce(function (acc, _, i) {
    var _stateS$annotations$i3;
    return acc + (Object.values(((_stateS$annotations$i3 = stateS.annotations[i]) === null || _stateS$annotations$i3 === void 0 ? void 0 : _stateS$annotations$i3.counts) || {}).reduce(function (x, y) {
      return x + (y || 0);
    }, 0) > 0 ? 1 : 0);
  }, 0);
  var tWords = render_countWordsInTranscription(stateT.items);
  var sWords = render_countWordsInTranscription(stateS.items);
  return {
    total: tTot + sTot,
    blocks: tBlocks + sBlocks,
    tTot: tTot,
    sTot: sTot,
    tBlocks: tBlocks,
    sBlocks: sBlocks,
    tWords: tWords,
    sWords: sWords
  };
}
function render_renderFooterTotals() {
  var _totalsCombined = totalsCombined(),
    total = _totalsCombined.total,
    blocks = _totalsCombined.blocks,
    tTot = _totalsCombined.tTot,
    sTot = _totalsCombined.sTot,
    tBlocks = _totalsCombined.tBlocks,
    sBlocks = _totalsCombined.sBlocks,
    tWords = _totalsCombined.tWords,
    sWords = _totalsCombined.sWords;
  $('#badgeTotals').textContent = "Errores: ".concat(total);
  $('#badgeBlocks').textContent = "Bloques con error: ".concat(blocks);
  $('#badgeWords').textContent = "Palabras totales: ".concat(tWords + sWords);
  var panel = $('#footerPanel');
  panel.innerHTML = '';
  panel.append(el('div', {}, el('strong', {}, 'Totales por tab')));
  var small = el('table', {
    style: 'margin:6px 0; width:100%'
  });
  small.append(el('thead', {}, el('tr', {}, el('th', {}, 'Tab'), el('th', {}, 'Errores'), el('th', {}, 'Bloques con error'), el('th', {}, 'Palabras'))));
  small.append(el('tbody', {}, el('tr', {}, el('td', {}, 'Transcripci√≥n'), el('td', {}, String(tTot)), el('td', {}, String(tBlocks)), el('td', {}, String(tWords))), el('tr', {}, el('td', {}, 'S√≠ntesis'), el('td', {}, String(sTot)), el('td', {}, String(sBlocks)), el('td', {}, String(sWords))), el('tr', {}, el('td', {}, 'Total'), el('td', {}, String(total)), el('td', {}, String(blocks)), el('td', {}, String(tWords + sWords)))));
  panel.append(small);
  var tTable = el('table', {
    style: 'width:100%; margin-top:8px'
  });
  tTable.append(el('thead', {}, el('tr', {}, el('th', {}, 'Transcripci√≥n - Tipo'), el('th', {}, 'Total'))));
  var tTb = el('tbody');
  ERROR_CATALOG_T.forEach(function (err) {
    var tot = stateT.items.reduce(function (acc, _, i) {
      var _stateT$annotations$i4;
      return acc + (((_stateT$annotations$i4 = stateT.annotations[i]) === null || _stateT$annotations$i4 === void 0 || (_stateT$annotations$i4 = _stateT$annotations$i4.counts) === null || _stateT$annotations$i4 === void 0 ? void 0 : _stateT$annotations$i4[err.key]) || 0);
    }, 0);
    tTb.append(el('tr', {}, el('td', {}, err.label), el('td', {}, String(tot))));
  });
  tTable.append(tTb);
  panel.append(tTable);
  var sTable = el('table', {
    style: 'width:100%; margin-top:8px'
  });
  sTable.append(el('thead', {}, el('tr', {}, el('th', {}, 'S√≠ntesis - Tipo'), el('th', {}, 'Total'))));
  var sTb = el('tbody');
  ERROR_CATALOG_S.forEach(function (err) {
    var tot = stateS.items.reduce(function (acc, _, i) {
      var _stateS$annotations$i4;
      return acc + (((_stateS$annotations$i4 = stateS.annotations[i]) === null || _stateS$annotations$i4 === void 0 || (_stateS$annotations$i4 = _stateS$annotations$i4.counts) === null || _stateS$annotations$i4 === void 0 ? void 0 : _stateS$annotations$i4[err.key]) || 0);
    }, 0);
    sTb.append(el('tr', {}, el('td', {}, err.label), el('td', {}, String(tot))));
  });
  sTable.append(sTb);
  panel.append(sTable);
}

// Exponer funciones globalmente
window.getCtx = getCtx;
window.countWordsInTranscription = render_countWordsInTranscription;
window.timePill = timePill;
window.render = render_render;
window.renderAll = render_renderAll;
window.totalsByType = render_totalsByType;
window.totalsCombined = totalsCombined;
window.renderFooterTotals = render_renderFooterTotals;
;// ./src/js/export.js
function export_toConsumableArray(r) { return export_arrayWithoutHoles(r) || export_iterableToArray(r) || export_unsupportedIterableToArray(r) || export_nonIterableSpread(); }
function export_nonIterableSpread() { throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }
function export_unsupportedIterableToArray(r, a) { if (r) { if ("string" == typeof r) return export_arrayLikeToArray(r, a); var t = {}.toString.call(r).slice(8, -1); return "Object" === t && r.constructor && (t = r.constructor.name), "Map" === t || "Set" === t ? Array.from(r) : "Arguments" === t || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t) ? export_arrayLikeToArray(r, a) : void 0; } }
function export_iterableToArray(r) { if ("undefined" != typeof Symbol && null != r[Symbol.iterator] || null != r["@@iterator"]) return Array.from(r); }
function export_arrayWithoutHoles(r) { if (Array.isArray(r)) return export_arrayLikeToArray(r); }
function export_arrayLikeToArray(r, a) { (null == a || a > r.length) && (a = r.length); for (var e = 0, n = Array(a); e < a; e++) n[e] = r[e]; return n; }
// Exportaci√≥n CSV y helpers relacionados
function errorPercentage(totalErrors, totalWords) {
  if (!totalWords) return '0%';
  return (totalErrors / totalWords * 100).toFixed(2) + '%';
}
function buildCSV_T() {
  var meetingDate = getMeetingDate();
  var title = getMeetingTitle();
  var headers = ['index', 'speaker', 'start', 'end', 'text', 'totalErrors'].concat(export_toConsumableArray(ERROR_CATALOG_T.map(function (e) {
    return "err_".concat(e.key);
  })), ['palabras', 'porcentajeError', 'note']);
  var rows = stateT.items.map(function (b, i) {
    var _stateT$annotations$i, _stateT$annotations$i2;
    var counts = ((_stateT$annotations$i = stateT.annotations[i]) === null || _stateT$annotations$i === void 0 ? void 0 : _stateT$annotations$i.counts) || {};
    var total = Object.values(counts).reduce(function (a, b) {
      return a + (b || 0);
    }, 0);
    var words = (b.text || '').trim().split(/\s+/).filter(Boolean).length;
    var porcentajeError = errorPercentage(total, words);
    var start = b.start || b.start_date_time;
    var end = b.end || b.end_date_time;
    if (meetingDate && start) start = secondsToTimestamp(getBiteOffsetSeconds(start, meetingDate));
    if (meetingDate && end) end = secondsToTimestamp(getBiteOffsetSeconds(end, meetingDate));
    return [i + 1, safe(b.speaker), start, end, safe(b.text).replace(/\n/g, ' '), total].concat(export_toConsumableArray(ERROR_CATALOG_T.map(function (e) {
      return counts[e.key] || 0;
    })), [words, porcentajeError, safe(((_stateT$annotations$i2 = stateT.annotations[i]) === null || _stateT$annotations$i2 === void 0 ? void 0 : _stateT$annotations$i2.note) || '').replace(/\n/g, ' ')]);
  });
  var totals = totalsByType('T');
  var grand = Object.values(totals).reduce(function (a, b) {
    return a + b;
  }, 0);
  var totalWords = countWordsInTranscription(stateT.items);
  var trow = ['TOTAL', '', '', '', '', grand].concat(export_toConsumableArray(ERROR_CATALOG_T.map(function (e) {
    return totals[e.key] || 0;
  })), [totalWords, errorPercentage(grand, totalWords), '']);

  // Construir CSV con t√≠tulo como primera l√≠nea si existe
  var csvLines = [];
  if (title) {
    csvLines.push(csvEscape(title));
    csvLines.push(''); // L√≠nea vac√≠a despu√©s del t√≠tulo
  }
  csvLines.push(headers.join(','));
  csvLines.push.apply(csvLines, export_toConsumableArray(rows.map(function (r) {
    return r.map(csvEscape).join(',');
  })));
  csvLines.push('');
  csvLines.push(trow.map(csvEscape).join(','));
  return csvLines.join('\n');
}
function buildCSV_S() {
  var title = getMeetingTitle();
  var headers = ['index', 'title', 'text', 'totalErrors'].concat(export_toConsumableArray(ERROR_CATALOG_S.map(function (e) {
    return "err_".concat(e.key);
  })), ['palabras', 'porcentajeError', 'note']);
  var rows = stateS.items.map(function (b, i) {
    var _stateS$annotations$i, _stateS$annotations$i2;
    var counts = ((_stateS$annotations$i = stateS.annotations[i]) === null || _stateS$annotations$i === void 0 ? void 0 : _stateS$annotations$i.counts) || {};
    var total = Object.values(counts).reduce(function (a, b) {
      return a + (b || 0);
    }, 0);
    var words = (b.text || '').trim().split(/\s+/).filter(Boolean).length;
    var porcentajeError = errorPercentage(total, words);
    return [i + 1, safe(b.title), safe(b.text).replace(/\n/g, ' '), total].concat(export_toConsumableArray(ERROR_CATALOG_S.map(function (e) {
      return counts[e.key] || 0;
    })), [words, porcentajeError, safe(((_stateS$annotations$i2 = stateS.annotations[i]) === null || _stateS$annotations$i2 === void 0 ? void 0 : _stateS$annotations$i2.note) || '').replace(/\n/g, ' ')]);
  });
  var totals = totalsByType('S');
  var grand = Object.values(totals).reduce(function (a, b) {
    return a + b;
  }, 0);
  var totalWords = countWordsInTranscription(stateS.items);
  var trow = ['TOTAL', '', '', grand].concat(export_toConsumableArray(ERROR_CATALOG_S.map(function (e) {
    return totals[e.key] || 0;
  })), [totalWords, errorPercentage(grand, totalWords), '', '']);
  var csvOut = [];
  if (title) {
    csvOut.push(csvEscape(title));
    csvOut.push(''); // L√≠nea vac√≠a despu√©s del t√≠tulo
  }
  csvOut.push(headers.join(','));
  csvOut.push.apply(csvOut, export_toConsumableArray(rows.map(function (r) {
    return r.map(csvEscape).join(',');
  })));
  csvOut.push('');
  csvOut.push(trow.map(csvEscape).join(','));
  if (stateS.globalSynthText && stateS.globalSynthText.trim()) {
    csvOut.push('');
    csvOut.push(['', 'S√≠ntesis humana', stateS.globalSynthText.replace(/\n/g, ' '), ''].concat(export_toConsumableArray(Array(ERROR_CATALOG_S.length + 3).fill('')), ['']).map(csvEscape).join(','));
  }
  return csvOut.join('\n');
}
function export_exportCSV() {
  var partT = buildCSV_T();
  var partS = buildCSV_S();
  var title = getMeetingTitle();
  var sep = '\n\n';
  var csv = ['### SINTESIS', partS, sep, '### Enlace s√≠ntesis', sep, '### TRANSCRIPCION', partT, sep].join('\n');
  var blob = new Blob([csv], {
    type: 'text/csv;charset=utf-8;'
  });
  var url = URL.createObjectURL(blob);
  var a = document.createElement('a');

  // Generar nombre de archivo usando el t√≠tulo si existe
  var fileName = 'auditoria_transcripcion_sintesis';
  if (title) {
    // Limpiar el t√≠tulo para usar como nombre de archivo
    var cleanTitle = title.replace(/[^a-zA-Z0-9\-_\s]/g, '').replace(/\s+/g, '_').substring(0, 50);
    fileName = "auditoria_".concat(cleanTitle);
  }
  a.href = url;
  a.download = "".concat(fileName, ".csv");
  a.click();
  URL.revokeObjectURL(url);
}

// Funciones de backup completo
function export_exportBackup() {
  var title = getMeetingTitle();
  var backup = {
    version: '1.0',
    timestamp: new Date().toISOString(),
    meetingTitle: title,
    transcripcion: {
      items: stateT.items,
      annotations: stateT.annotations,
      enabledErrors: export_toConsumableArray(stateT.enabledErrors),
      filter: stateT.filter
    },
    sintesis: {
      items: stateS.items,
      annotations: stateS.annotations,
      enabledErrors: export_toConsumableArray(stateS.enabledErrors),
      filter: stateS.filter,
      globalSynthText: stateS.globalSynthText || ''
    }
  };
  var json = JSON.stringify(backup, null, 2);
  var blob = new Blob([json], {
    type: 'application/json'
  });
  var url = URL.createObjectURL(blob);
  var a = document.createElement('a');
  var now = new Date();
  var dateStr = now.toISOString().split('T')[0]; // YYYY-MM-DD
  var timeStr = now.toTimeString().split(' ')[0].replace(/:/g, '-'); // HH-MM-SS

  // Generar nombre de archivo usando el t√≠tulo si existe
  var fileName = "auditor-backup-".concat(dateStr, "-").concat(timeStr);
  if (title) {
    // Limpiar el t√≠tulo para usar como nombre de archivo
    var cleanTitle = title.replace(/[^a-zA-Z0-9\-_\s]/g, '').replace(/\s+/g, '_').substring(0, 30);
    fileName = "auditor-backup-".concat(cleanTitle, "-").concat(dateStr, "-").concat(timeStr);
  }
  a.href = url;
  a.download = "".concat(fileName, ".json");
  a.click();
  URL.revokeObjectURL(url);
}
function export_importBackup(jsonData) {
  try {
    var backup = JSON.parse(jsonData);

    // Validar estructura b√°sica
    if (!backup.version || !backup.transcripcion || !backup.sintesis) {
      throw new Error('Formato de backup inv√°lido');
    }

    // Restaurar t√≠tulo de la reuni√≥n
    if (backup.meetingTitle) {
      setMeetingTitle(backup.meetingTitle);
    } else {
      setMeetingTitle(''); // Limpiar t√≠tulo si no existe en el backup
    }

    // Restaurar estado de transcripci√≥n
    if (backup.transcripcion) {
      stateT.items = backup.transcripcion.items || [];
      stateT.annotations = backup.transcripcion.annotations || {};
      stateT.enabledErrors = new Set(backup.transcripcion.enabledErrors || ERROR_CATALOG_T.map(function (e) {
        return e.key;
      }));
      stateT.filter = backup.transcripcion.filter || '';
    }

    // Restaurar estado de s√≠ntesis
    if (backup.sintesis) {
      stateS.items = backup.sintesis.items || [];
      stateS.annotations = backup.sintesis.annotations || {};
      stateS.enabledErrors = new Set(backup.sintesis.enabledErrors || ERROR_CATALOG_S.map(function (e) {
        return e.key;
      }));
      stateS.filter = backup.sintesis.filter || '';
      stateS.globalSynthText = backup.sintesis.globalSynthText || '';

      // Actualizar el textarea de s√≠ntesis global si existe
      var synthTextarea = document.getElementById('global-synth-textarea');
      if (synthTextarea) {
        synthTextarea.value = stateS.globalSynthText;
      }
    }

    // Guardar en localStorage y re-renderizar
    saveToLocal();
    renderAll();
    renderFooterTotals();
    var titleInfo = backup.meetingTitle ? "\nT\xEDtulo: ".concat(backup.meetingTitle) : '';
    alert("Backup restaurado exitosamente.".concat(titleInfo, "\nFecha: ").concat(backup.timestamp ? new Date(backup.timestamp).toLocaleString() : 'Desconocida'));
  } catch (error) {
    console.error('Error al importar backup:', error);
    alert('Error al importar el backup: ' + error.message);
  }
}

// Exponer funciones globalmente
window.errorPercentage = errorPercentage;
window.buildCSV_T = buildCSV_T;
window.buildCSV_S = buildCSV_S;
window.exportCSV = export_exportCSV;
window.exportBackup = export_exportBackup;
window.importBackup = export_importBackup;
;// ./src/js/synth.js
// L√≥gica espec√≠fica de s√≠ntesis global
document.addEventListener('DOMContentLoaded', function () {
  var synthTextarea = document.getElementById('global-synth-textarea');
  if (!synthTextarea) return;

  // Guardar autom√°ticamente en el estado unificado
  synthTextarea.addEventListener('input', function () {
    if (stateS) {
      stateS.globalSynthText = synthTextarea.value;
      saveToLocal();
    }
  });
  function restoreGlobalSynthText() {
    if (stateS && synthTextarea) {
      synthTextarea.value = stateS.globalSynthText || '';
    }
  }

  // Cambiar de tab mantiene el valor
  restoreGlobalSynthText();
  var tabSynth = document.getElementById('tabSynth');
  if (tabSynth) tabSynth.addEventListener('click', restoreGlobalSynthText);
  if (synthTextarea && !synthTextarea.value) synthTextarea.value = '';
});
;// ./src/js/jsonSource.js
// Funciones para validar y cargar JSON source
function validateJsonSource(jsonText, expectedType) {
  try {
    var json = JSON.parse(jsonText);

    // Validar que tenga el array bites
    if (!json.bites || !Array.isArray(json.bites)) {
      return {
        valid: false,
        error: 'El JSON no contiene el array "bites" o no es v√°lido.'
      };
    }

    // Validar que tenga elementos
    if (json.bites.length === 0) {
      return {
        valid: false,
        error: 'El JSON no contiene ning√∫n elemento en el array "bites".'
      };
    }

    // Detectar tipo basado en el primer elemento
    var firstBite = json.bites[0];
    var detectedType = null;
    if ('title' in firstBite && !('speaker' in firstBite)) {
      detectedType = 'sintesis';
    } else if ('speaker' in firstBite) {
      detectedType = 'transcripcion';
    }

    // Validar que coincida con el tipo esperado
    if (!detectedType) {
      return {
        valid: false,
        error: 'El JSON no corresponde a un formato de transcripci√≥n ni de s√≠ntesis soportado.'
      };
    }
    if (detectedType !== expectedType) {
      return {
        valid: false,
        error: "El JSON corresponde a ".concat(detectedType, " pero se esperaba ").concat(expectedType, ".")
      };
    }
    return {
      valid: true,
      data: json,
      type: detectedType
    };
  } catch (error) {
    return {
      valid: false,
      error: 'El texto no es un JSON v√°lido.'
    };
  }
}
function convertJsonSourceToAuditorFormat(jsonData, type) {
  var bites = jsonData.bites;
  if (type === 'transcripcion') {
    // Convertir formato de transcripci√≥n
    return bites.map(function (bite) {
      var _bite$speaker;
      return {
        speaker: ((_bite$speaker = bite.speaker) === null || _bite$speaker === void 0 ? void 0 : _bite$speaker.name) || 'Desconocido',
        text: bite.text || '',
        start: bite.start_date_time || null,
        end: bite.end_date_time || null,
        // Mantener campos adicionales si son necesarios
        date: jsonData.date || null
      };
    });
  } else if (type === 'sintesis') {
    var _jsonData$meeting;
    // Convertir formato de s√≠ntesis
    // Para s√≠ntesis, la fecha de la reuni√≥n est√° en meeting.date
    var meetingDate = ((_jsonData$meeting = jsonData.meeting) === null || _jsonData$meeting === void 0 ? void 0 : _jsonData$meeting.date) || jsonData.date || null;
    return bites.map(function (bite) {
      return {
        title: bite.title || 'Sin t√≠tulo',
        text: bite.text || '',
        start: bite.start_date_time || null,
        end: bite.end_date_time || null,
        // Incluir la fecha de la reuni√≥n para c√°lculos de tiempo relativo
        start_date_time: bite.start_date_time || null,
        end_date_time: bite.end_date_time || null,
        // Mantener campos adicionales si son necesarios
        date: meetingDate
      };
    });
  }
  return [];
}
function jsonSource_setupJsonSourceValidation() {
  // Validaci√≥n para transcripci√≥n
  var textareaT = document.getElementById('jsonSourceTextT');
  var validationT = document.getElementById('jsonValidationT');
  var buttonT = document.getElementById('loadJsonSourceT');
  if (textareaT && validationT && buttonT) {
    textareaT.addEventListener('input', function () {
      var text = textareaT.value.trim();
      if (!text) {
        validationT.innerHTML = '';
        buttonT.disabled = true;
        return;
      }
      var result = validateJsonSource(text, 'transcripcion');
      if (result.valid) {
        validationT.innerHTML = '<span style="color: #16a34a; font-weight: bold;">‚úì JSON de transcripci√≥n v√°lido</span> - Listo para cargar.';
        buttonT.disabled = false;
      } else {
        validationT.innerHTML = "<span style=\"color: #dc2626; font-weight: bold;\">\u2717 Error:</span> ".concat(result.error);
        buttonT.disabled = true;
      }
    });
    buttonT.addEventListener('click', function () {
      var text = textareaT.value.trim();
      var result = validateJsonSource(text, 'transcripcion');
      if (result.valid) {
        var convertedData = convertJsonSourceToAuditorFormat(result.data, 'transcripcion');

        // Extraer y guardar el t√≠tulo de la reuni√≥n (transcripci√≥n: propiedad "title" a primer nivel)
        var title = result.data.title || '';
        setMeetingTitle(title);

        // Cambiar al tab de transcripci√≥n y cargar datos
        activeTab = 'T';
        stateT.items = convertedData;
        stateT.annotations = {}; // Reset anotaciones

        // Actualizar UI
        document.getElementById('tabTrans').setAttribute('aria-selected', 'true');
        document.getElementById('tabSynth').setAttribute('aria-selected', 'false');
        document.getElementById('tabTransWrap').classList.remove('hidden');
        document.getElementById('tabSynthWrap').classList.add('hidden');
        renderAll();
        saveToLocal();

        // Cerrar el details y limpiar
        document.getElementById('jsonSourceSectionT').open = false;
        textareaT.value = '';
        validationT.innerHTML = '';
        buttonT.disabled = true;
        alert("Transcripci\xF3n cargada exitosamente: ".concat(convertedData.length, " bloques procesados."));
      }
    });
  }

  // Validaci√≥n para s√≠ntesis
  var textareaS = document.getElementById('jsonSourceTextS');
  var validationS = document.getElementById('jsonValidationS');
  var buttonS = document.getElementById('loadJsonSourceS');
  if (textareaS && validationS && buttonS) {
    textareaS.addEventListener('input', function () {
      var text = textareaS.value.trim();
      if (!text) {
        validationS.innerHTML = '';
        buttonS.disabled = true;
        return;
      }
      var result = validateJsonSource(text, 'sintesis');
      if (result.valid) {
        validationS.innerHTML = '<span style="color: #16a34a; font-weight: bold;">‚úì JSON de s√≠ntesis v√°lido</span> - Listo para cargar.';
        buttonS.disabled = false;
      } else {
        validationS.innerHTML = "<span style=\"color: #dc2626; font-weight: bold;\">\u2717 Error:</span> ".concat(result.error);
        buttonS.disabled = true;
      }
    });
    buttonS.addEventListener('click', function () {
      var text = textareaS.value.trim();
      var result = validateJsonSource(text, 'sintesis');
      if (result.valid) {
        var _result$data$meeting;
        var convertedData = convertJsonSourceToAuditorFormat(result.data, 'sintesis');

        // Extraer y guardar el t√≠tulo de la reuni√≥n (s√≠ntesis: propiedad "title" en meeting)
        var title = ((_result$data$meeting = result.data.meeting) === null || _result$data$meeting === void 0 ? void 0 : _result$data$meeting.title) || '';
        setMeetingTitle(title);

        // Cambiar al tab de s√≠ntesis y cargar datos
        activeTab = 'S';
        stateS.items = convertedData;
        stateS.annotations = {}; // Reset anotaciones

        // Actualizar UI
        document.getElementById('tabTrans').setAttribute('aria-selected', 'false');
        document.getElementById('tabSynth').setAttribute('aria-selected', 'true');
        document.getElementById('tabTransWrap').classList.add('hidden');
        document.getElementById('tabSynthWrap').classList.remove('hidden');
        renderAll();
        saveToLocal();

        // Cerrar el details y limpiar
        document.getElementById('jsonSourceSectionS').open = false;
        textareaS.value = '';
        validationS.innerHTML = '';
        buttonS.disabled = true;
        alert("S\xEDntesis cargada exitosamente: ".concat(convertedData.length, " bloques procesados."));
      }
    });
  }
}

// Exponer funciones globalmente
window.validateJsonSource = validateJsonSource;
window.convertJsonSourceToAuditorFormat = convertJsonSourceToAuditorFormat;
window.setupJsonSourceValidation = jsonSource_setupJsonSourceValidation;
;// ./src/js/errorCatalogs.js
// Cat√°logos de errores para transcripci√≥n y s√≠ntesis
// Este archivo contiene las definiciones de todos los tipos de errores
// que se pueden anotar en el auditor

// Cat√°logo de errores para TRANSCRIPCI√ìN
var errorCatalogs_ERROR_CATALOG_T = [{
  key: 'orador',
  label: 'Err. orador',
  desc: 'Hablante asignado ‚â† real'
}, {
  key: 'cambio',
  label: 'Err. cambio habl.',
  desc: 'Se omiti√≥ cambio de hablante'
}, {
  key: 'termino',
  label: 'Err. t√©rmino',
  desc: 'Palabra mal transcrita'
}, {
  key: 'precision',
  label: 'Err. precisi√≥n',
  desc: 'Informaci√≥n mal recogida'
}, {
  key: 'omision',
  label: 'Err. omisi√≥n',
  desc: 'Falta info que s√≠ se dijo'
}, {
  key: 'anadido',
  label: 'Err. a√±adido',
  desc: 'Se a√±adi√≥ contenido no dicho'
}, {
  key: 'colapso',
  label: 'Err. colapso',
  desc: 'Voces simult√°neas mal tratadas'
}, {
  key: 'ortografia',
  label: 'Err. ortograf√≠a',
  desc: 'Ortograf√≠a/puntuaci√≥n pobre'
}, {
  key: 'estilo',
  label: 'Err. estilo',
  desc: 'Ruido excesivo / muletillas'
}, {
  key: 'fragmentacion',
  label: 'Err. fragmentaci√≥n',
  desc: 'Bloques separados de un mismo orador'
}];

// Cat√°logo de errores para S√çNTESIS
var errorCatalogs_ERROR_CATALOG_S = [{
  key: 'coherencia',
  label: 'Coherencia',
  desc: 'Ideas conectadas y ordenadas'
}, {
  key: 'completitud',
  label: 'Completitud',
  desc: 'Cubre todos los puntos clave'
}, {
  key: 'relevancia',
  label: 'Relevancia',
  desc: 'Evita ruido y relleno'
}, {
  key: 'redundancia',
  label: 'Redundancia',
  desc: 'Repeticiones innecesarias'
}, {
  key: 'estructura',
  label: 'Estructura',
  desc: 'Titulado y secciones claras'
}, {
  key: 'segmentacion',
  label: 'Segmentaci√≥n',
  desc: 'Exceso de conceptos en mismo bloque'
}];

// Exponer cat√°logos globalmente
window.ERROR_CATALOG_T = errorCatalogs_ERROR_CATALOG_T;
window.ERROR_CATALOG_S = errorCatalogs_ERROR_CATALOG_S;
;// ./src/js/main.js










// Estado global y cat√°logos
var main_activeTab = 'T'; // 'T' transcripci√≥n, 'S' s√≠ntesis, 'H' ayuda
var main_stateT = {
  items: [],
  annotations: {},
  enabledErrors: new Set(errorCatalogs_ERROR_CATALOG_T.map(function (e) {
    return e.key;
  })),
  filter: ''
};
var main_stateS = {
  items: [],
  annotations: {},
  enabledErrors: new Set(errorCatalogs_ERROR_CATALOG_S.map(function (e) {
    return e.key;
  })),
  filter: '',
  globalSynthText: ''
};

// Variable global para el t√≠tulo de la reuni√≥n
var main_meetingTitle = '';

// Exponer variables y funciones globalmente
window.ERROR_CATALOG_T = errorCatalogs_ERROR_CATALOG_T;
window.ERROR_CATALOG_S = errorCatalogs_ERROR_CATALOG_S;
window.stateT = main_stateT;
window.stateS = main_stateS;
window.activeTab = main_activeTab;
window.meetingTitle = main_meetingTitle;

// Funciones de anotaci√≥n y edici√≥n
function setItems(json) {
  if (main_activeTab === 'S') {
    main_stateS.items = json.items || [];
    main_stateS.annotations = {};
    main_stateS.items.forEach(function (_, i) {
      return main_stateS.annotations[i] = {
        counts: {},
        note: '',
        open: false
      };
    });
  } else if (main_activeTab === 'T') {
    main_stateT.items = json.items || [];
    main_stateT.annotations = {};
    main_stateT.items.forEach(function (_, i) {
      return main_stateT.annotations[i] = {
        counts: {},
        note: '',
        open: false
      };
    });
    if (json.date) {
      main_stateT.meetingDate = json.date;
      window.lastMeetingDate = json.date;
    }
    window.lastMeetingJson = json;
  }
  renderAll();
  saveToLocal();
}
window.setItems = setItems;
function main_toggleErrorType(tab, key) {
  var st = tab === 'S' ? main_stateS : main_stateT;
  if (st.enabledErrors.has(key)) st.enabledErrors["delete"](key);else st.enabledErrors.add(key);
  render(tab);
  saveToLocal();
}
window.toggleErrorType = main_toggleErrorType;
function main_incrementError(tab, index, key, delta) {
  var _st$annotations;
  var st = tab === 'S' ? main_stateS : main_stateT;
  var ann = (_st$annotations = st.annotations)[index] || (_st$annotations[index] = {
    counts: {},
    note: '',
    open: false
  });
  ann.counts[key] = (ann.counts[key] || 0) + delta;
  if (ann.counts[key] < 0) ann.counts[key] = 0;
  render(tab);
  renderFooterTotals();
  saveToLocal();
}
window.incrementError = main_incrementError;
function main_toggleNote(tab, index) {
  var _st$annotations2;
  var st = tab === 'S' ? main_stateS : main_stateT;
  var ann = (_st$annotations2 = st.annotations)[index] || (_st$annotations2[index] = {
    counts: {},
    note: '',
    open: false
  });
  ann.open = !ann.open;
  render(tab);
  saveToLocal();
}
window.toggleNote = main_toggleNote;
function main_setNote(tab, index, text) {
  var _st$annotations3;
  var st = tab === 'S' ? main_stateS : main_stateT;
  var ann = (_st$annotations3 = st.annotations)[index] || (_st$annotations3[index] = {
    counts: {},
    note: '',
    open: false
  });
  ann.note = text;
  saveToLocal();
}
window.setNote = main_setNote;
function main_getMeetingDate() {
  // Asegurar que tenemos un activeTab v√°lido
  if (!main_activeTab) {
    main_activeTab = 'T'; // Default fallback
  }
  var items = main_activeTab === 'T' ? (main_stateT === null || main_stateT === void 0 ? void 0 : main_stateT.items) || [] : (main_stateS === null || main_stateS === void 0 ? void 0 : main_stateS.items) || [];

  // Si no hay items, retornar null
  if (!items || items.length === 0) {
    return null;
  }
  for (var i = 0; i < items.length; i++) {
    var dateValue = items[i].date;
    if (dateValue && dateValue !== 'undefined' && dateValue !== '') {
      return dateValue;
    }
  }
  return null;
}
window.getMeetingDate = main_getMeetingDate;
function main_getBiteOffsetSeconds(biteDate, meetingDate) {
  if (!biteDate || !meetingDate) return 0;
  var diffMs = new Date(biteDate).getTime() - new Date(meetingDate).getTime();
  return Math.max(0, Math.floor(diffMs / 1000));
}
window.getBiteOffsetSeconds = main_getBiteOffsetSeconds;

// Funciones para manejar el t√≠tulo de la reuni√≥n
function main_setMeetingTitle(title) {
  main_meetingTitle = title || '';
  window.meetingTitle = main_meetingTitle;
  updateHeaderTitle();
}
function updateHeaderTitle() {
  var headerTitle = document.querySelector('h1');
  if (headerTitle) {
    if (main_meetingTitle) {
      headerTitle.textContent = "Auditor - ".concat(main_meetingTitle);
    } else {
      headerTitle.textContent = 'Auditor';
    }
  }
}
function main_getMeetingTitle() {
  return main_meetingTitle;
}
window.setMeetingTitle = main_setMeetingTitle;
window.updateHeaderTitle = updateHeaderTitle;
window.getMeetingTitle = main_getMeetingTitle;

// Funciones para manejar la persistencia de tabs en URL
function setActiveTab(tab) {
  main_activeTab = tab;
  window.activeTab = main_activeTab;

  // Actualizar URL hash
  var hashMap = {
    'T': 'transcripcion',
    'S': 'sintesis',
    'H': 'ayuda'
  };
  window.location.hash = hashMap[tab] || 'transcripcion';
}
function getTabFromHash() {
  var hash = window.location.hash.substring(1); // Quitar el #
  var tabMap = {
    'transcripcion': 'T',
    'sintesis': 'S',
    'ayuda': 'H'
  };
  return tabMap[hash] || 'T'; // Default a transcripci√≥n
}
function switchToTab(tab) {
  setActiveTab(tab);

  // Actualizar UI de tabs
  document.getElementById('tabTrans').setAttribute('aria-selected', tab === 'T' ? 'true' : 'false');
  document.getElementById('tabSynth').setAttribute('aria-selected', tab === 'S' ? 'true' : 'false');
  document.getElementById('tabHelp').setAttribute('aria-selected', tab === 'H' ? 'true' : 'false');

  // Mostrar/ocultar contenido
  document.getElementById('tabTransWrap').classList.toggle('hidden', tab !== 'T');
  document.getElementById('tabSynthWrap').classList.toggle('hidden', tab !== 'S');
  document.getElementById('tabHelpWrap').classList.toggle('hidden', tab !== 'H');

  // Manejar sidebar
  if (tab === 'H') {
    document.getElementById('sidebar-legend').style.display = 'none';
  } else {
    renderSidebarLegend(tab);
  }
}
window.setActiveTab = setActiveTab;
window.getTabFromHash = getTabFromHash;
window.switchToTab = switchToTab;

// Funci√≥n para renderizar la leyenda de la sidebar
function renderSidebarLegend(tab) {
  var legendDiv = document.getElementById('sidebar-legend-content');
  var sidebarLegend = document.getElementById('sidebar-legend');

  // Mostrar la sidebar si estaba oculta
  sidebarLegend.style.display = 'block';
  var html = '';
  if (tab === 'T') {
    html += '<div class="legend-block"><b>Leyenda errores transcripci√≥n:</b><ul style="margin:0.5em 0 0 1em;padding:0;">';
    errorCatalogs_ERROR_CATALOG_T.forEach(function (e) {
      html += "<li><b>".concat(e.label, ":</b> <span style='color:#444'>").concat(e.desc, "</span></li>");
    });
    html += '</ul></div>';
  } else if (tab === 'S') {
    html += '<div class="legend-block"><b>Leyenda errores s√≠ntesis:</b><ul style="margin:0.5em 0 0 1em;padding:0;">';
    errorCatalogs_ERROR_CATALOG_S.forEach(function (e) {
      html += "<li><b>".concat(e.label, ":</b> <span style='color:#444'>").concat(e.desc, "</span></li>");
    });
    html += '</ul></div>';
  }
  legendDiv.innerHTML = html;
}
window.renderSidebarLegend = renderSidebarLegend;

// Inicializaci√≥n y listeners principales
document.addEventListener('DOMContentLoaded', function () {
  // Mostrar versi√≥n de la app
  var versionElement = document.getElementById('app-version');
  if (versionElement) {
    try {
      // Intentar usar la variable inyectada por Webpack
      var version =  true ? "2.0.0" : 0;
      versionElement.textContent = "v".concat(version);
      console.log('App version loaded:', version);
    } catch (error) {
      // Fallback si hay error
      versionElement.textContent = 'error';
      console.warn('Version injection failed, using fallback:', error);
    }
  }

  // Cargar estado local
  loadFromLocal();

  // Configurar validaci√≥n de JSON source
  setupJsonSourceValidation();

  // Demo si vac√≠o
  if (main_stateT.items.length === 0 && main_stateS.items.length === 0) {
    main_stateT.items = [{
      speaker: 'Ana',
      start: '00:00:05.000',
      end: '00:00:14.000',
      text: 'INFO EJEMPLO Bienvenidos a la reuni√≥n. Hoy vemos el roadmap del Q4.'
    }, {
      speaker: 'Luis',
      start: '00:00:14.100',
      end: '00:00:26.000',
      text: 'INFO EJEMPLO Tenemos tres objetivos: ventas, soporte y lanzamiento de la app.'
    }];
    main_stateT.annotations = {
      0: {
        counts: {},
        note: '',
        open: false
      },
      1: {
        counts: {},
        note: '',
        open: false
      }
    };
    main_stateS.items = [{
      title: 'Objetivos Q4',
      text: 'INFO EJEMPLO Ventas, soporte y lanzamiento de app.'
    }, {
      title: 'Bloqueadores',
      text: 'INFO EJEMPLO Validaci√≥n de seguridad pendiente.'
    }];
    main_stateS.annotations = {
      0: {
        counts: {},
        note: '',
        open: false
      },
      1: {
        counts: {},
        note: '',
        open: false
      }
    };
    // Guardar datos mock en localStorage
    saveToLocal();
  }

  // Inicializar tab desde URL o default
  switchToTab(getTabFromHash());

  // Renderizar todo despu√©s de cargar/inicializar datos
  renderAll();
  renderFooterTotals();

  // Eventos de archivo, exportar, reset
  $('#file').addEventListener('change', function (e) {
    var f = e.target.files[0];
    if (!f) return;
    var r = new FileReader();
    r.onload = function () {
      try {
        var json = JSON.parse(r.result);

        // Detectar si es un backup completo o datos del tab activo
        if (json.version && json.transcripcion && json.sintesis) {
          // Es un backup completo
          if (confirm('¬øDeseas restaurar este backup completo? Esto sobrescribir√° todos los datos actuales.')) {
            importBackup(r.result);
          }
        } else {
          // Es un JSON del tab activo (comportamiento original)
          setItems(json);
        }
      } catch (error) {
        console.error('Error al procesar archivo:', error);
        alert('Error al procesar el archivo JSON: ' + error.message);
      }
    };
    r.readAsText(f);
  });
  $('#saveBackup').addEventListener('click', exportBackup);
  $('#exportCsv').addEventListener('click', exportCSV);
  $('#reset').addEventListener('click', function () {
    if (confirm('¬øBorrar todo el estado guardado (transcripci√≥n y s√≠ntesis)?')) {
      localStorage.removeItem(LS_T);
      localStorage.removeItem(LS_S);
      localStorage.removeItem(LS_TITLE);
      location.reload();
    }
  });

  // Filtros
  $('#qT').addEventListener('input', function (e) {
    main_stateT.filter = e.target.value.trim();
    render('T');
  });
  $('#qT').addEventListener('keydown', function (e) {
    if (e.key === 'Enter' && e.target.value === '') {
      main_stateT.filter = '';
      e.target.value = '';
      render('T');
    }
  });
  $('#qS').addEventListener('input', function (e) {
    main_stateS.filter = e.target.value.trim();
    render('S');
  });
  $('#qS').addEventListener('keydown', function (e) {
    if (e.key === 'Enter' && e.target.value === '') {
      main_stateS.filter = '';
      e.target.value = '';
      render('S');
    }
  });

  // Tabs
  $('#tabTrans').addEventListener('click', function () {
    switchToTab('T');
  });
  $('#tabSynth').addEventListener('click', function () {
    switchToTab('S');
  });
  $('#tabHelp').addEventListener('click', function () {
    switchToTab('H');
  });

  // Footer toggle
  $('#toggleFooter').addEventListener('click', function () {
    $('#footerTotals').classList.toggle('open');
  });

  // Leyenda toggle
  var legendToggleBtn = document.getElementById('legend-toggle-btn');
  var legendChevron = document.getElementById('legend-chevron');
  var legendContent = document.getElementById('sidebar-legend-content');
  legendToggleBtn.addEventListener('click', function () {
    legendContent.classList.toggle('open');
    legendChevron.classList.toggle('open');
  });
  legendContent.classList.remove('open');
  legendChevron.classList.remove('open');
});

// Listener para cambios en el hash (navegaci√≥n del navegador)
window.addEventListener('hashchange', function () {
  var tabFromHash = getTabFromHash();
  if (tabFromHash !== main_activeTab) {
    switchToTab(tabFromHash);
  }
});
/******/ })()
;</script></body>
</html>
